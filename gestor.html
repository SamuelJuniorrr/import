<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portal Fluig - Aprova√ß√£o Gerencial</title>
    <!-- A biblioteca html2pdf.js foi removida, pois a visualiza√ß√£o agora √© simulada em HTML. -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap');

        :root {
            --primary-color: #007bff;
            --secondary-color: #6c757d;
            --text-color: #333;
            --light-gray: #f8f9fa;
            --border-color: #dee2e6;
            --header-bg: #fff;
            --table-header-bg: #e9ecef;
            --shadow: 0 2px 4px rgba(0,0,0,0.05);
            --red-alert: #dc3545;
            --green-success: #28a745;
            --orange-warning: #ffc107;
            --colombia-bg: #e6f7ff;
            --hongkong-bg: #fff3e0;
            --colombia-border: #90cdf4;
            --hongkong-border: #ffcc80;
            --highlight-bg: #e0f7fa; /* Light blue for highlights */
            --highlight-border: #00bcd4; /* Cyan for highlight borders */
            --dark-blue: #004085; /* Darker blue for key text */

            /* Novas vari√°veis para cores das colunas PO e PI */
            --po-column-bg: rgba(0, 123, 255, 0.05); /* Light primary blue */
            --pi-column-bg: rgba(108, 117, 125, 0.05); /* Light secondary gray */

            /* Cores espec√≠ficas para as se√ß√µes da tela Geral */
            --general-section-bg-light-blue: #e6f7ff; /* Cor de fundo para Informa√ß√µes da PO / Partes Envolvidas */
            --general-section-border-light-blue: #90cdf4;
            --general-section-bg-light-green: #e6ffe6; /* Cor de fundo para An√°lise Financeira */
            --general-section-border-light-green: #a7d9a7;
            --general-section-bg-lighter-blue: #f0f8ff; /* Cor de fundo para Detalhes Log√≠sticos */
            --general-section-border-lighter-blue: #aaddff;
            --general-section-bg-light-gray: #f8f8f8; /* Cor de fundo para Hist√≥rico de Status */
            --general-section-border-light-gray: #e0e0e0;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Roboto', sans-serif;
            color: var(--text-color);
        }

        body {
            background-color: var(--light-gray);
            line-height: 1.6;
            font-size: 14px;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        .page {
            display: none;
            width: 100%;
            flex-grow: 1;
        }

        .page.active {
            display: flex;
            flex-direction: column;
        }

        .hidden {
            display: none !important;
        }

        .header {
            background-color: var(--header-bg);
            padding: 15px 40px; /* Mant√©m o padding do header */
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: var(--shadow);
        }

        .header h1 {
            font-size: 20px;
            font-weight: 500;
            margin-bottom: 5px;
        }

        .header p {
            font-size: 13px;
            color: #666;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .header-icon {
            background-color: #e0e0e0;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: bold;
            color: #666;
            cursor: pointer;
            flex-shrink: 0;
        }

        .btn-primary {
            background-color: var(--primary-color);
            color: #fff;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: background-color 0.2s ease-in-out;
            white-space: nowrap;
        }

        .btn-primary:hover {
            background-color: #0056b3;
        }

        .btn-secondary {
            background-color: var(--secondary-color);
            color: #fff;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: background-color 0.2s ease-in-out;
            white-space: nowrap;
        }

        .btn-secondary:hover {
            background-color: #5a6268;
        }

        .input-group {
            margin-bottom: 15px;
        }

        .input-group label {
            display: block;
            margin-bottom: 5px;
            font-size: 13px;
            font-weight: 500;
            color: #555;
        }

        .input-group input[type="text"],
        .input-group input[type="password"],
        .input-group input[type="number"],
        .input-group input[type="file"],
        .input-group select,
        textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--border-color);
            border-radius: 5px;
            font-size: 14px;
            outline: none;
            transition: border-color 0.2s ease-in-out;
        }

        .input-group input:focus,
        .input-group select:focus,
        textarea:focus {
            border-color: var(--primary-color);
        }

        .icon-user::before { content: 'üë§'; }
        .icon-lock::before { content: 'üîí'; }
        .icon-search::before { content: 'üîç'; }
        .icon-plus::before { content: '‚ûï'; }
        .icon-question::before { content: '?'; }
        .icon-flow::before { content: '!'; } /* √çcone para o bot√£o Fluxo */


        .container {
            width: 100%; /* Garante que ocupe a largura total dispon√≠vel */
            padding: 20px 40px; /* Ajusta o padding para ser consistente com o header */
            margin: 20px auto; /* Mant√©m a centraliza√ß√£o vertical e margens */
            background-color: #fff;
            border-radius: 8px;
            box-shadow: var(--shadow);
            flex-grow: 1;
        }

        .filters {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 20px;
            padding: 15px;
            background-color: #fff;
            border-radius: 8px;
            box-shadow: var(--shadow);
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
            flex-grow: 1;
            min-width: 150px;
        }

        .filter-group label {
            font-weight: 500;
            color: #555;
            font-size: 13px;
            white-space: nowrap;
        }

        .filter-group select,
        .filter-group input {
            padding: 8px 10px;
            border: 1px solid var(--border-color);
            border-radius: 5px;
            font-size: 14px;
            min-width: 120px;
        }

        .search-group {
            flex-grow: 2;
            display: flex;
            flex-direction: column;
            gap: 5px;
            min-width: 250px;
        }

        .search-input-wrapper {
            display: flex;
            width: 100%;
        }

        .search-group input {
            flex-grow: 1;
            border-right: none;
            border-top-right-radius: 0;
            border-bottom-right-radius: 0;
        }

        .search-icon-btn {
            background-color: transparent;
            border: 1px solid var(--border-color);
            border-left: none;
            border-radius: 0 5px 5px 0;
            padding: 8px 12px;
            cursor: pointer;
            font-size: 16px;
            color: #666;
        }

        .table-container {
            overflow-x: auto;
            margin-top: 20px;
            border-radius: 8px;
            box-shadow: var(--shadow);
            background-color: #fff;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        table thead th {
            background-color: var(--table-header-bg);
            padding: 12px 15px;
            text-align: left;
            font-weight: 600;
            font-size: 12px;
            color: #555;
            text-transform: uppercase;
            border-bottom: 1px solid var(--border-color);
            white-space: nowrap;
        }

        table tbody td {
            padding: 10px 15px;
            border-bottom: 1px solid #f0f0f0;
            font-size: 13px;
            vertical-align: middle;
            white-space: nowrap;
        }

        table tbody tr:hover {
            background-color: #f5f5f5;
        }

        .pedido-link {
            color: var(--primary-color);
            text-decoration: none;
            font-weight: 500;
        }

        .pedido-link:hover {
            text-decoration: underline;
        }

        .flag-icon {
            width: 16px;
            height: 11px;
            vertical-align: middle;
            margin-right: 5px;
            border: 1px solid #eee;
        }

        .footer-button {
            text-align: right;
            margin-top: 20px;
            padding: 10px 0;
        }

        .form-section {
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border-color);
        }

        .tab-buttons {
            display: flex;
            border-bottom: 1px solid var(--border-color);
            margin-bottom: 20px;
        }

        .tab-button {
            background-color: transparent;
            border: none;
            padding: 10px 20px;
            cursor: pointer;
            font-size: 15px;
            font-weight: 500;
            color: #666;
            border-bottom: 3px solid transparent;
            transition: all 0.2s ease-in-out;
        }

        .tab-button.active {
            color: var(--primary-color);
            border-bottom-color: var(--primary-color);
        }

        .tab-content {
            display: none;
            padding: 20px 0;
        }

        .tab-content.active {
            display: block;
        }

        .tab-content h2 {
            font-size: 18px;
            margin-bottom: 10px;
            font-weight: 500;
        }

        .tab-content p {
            font-size: 13px;
            color: #666;
            margin-bottom: 15px;
        }

        .accordion {
            border: 1px solid var(--border-color);
            border-radius: 5px;
            margin-bottom: 20px;
            overflow: hidden;
        }

        .accordion-item {
            border-bottom: 1px solid var(--border-color);
        }

        .accordion-item:last-child {
            border-bottom: none;
        }

        .accordion-header {
            width: 100%;
            background-color: #f7f7f7;
            padding: 12px 15px;
            text-align: left;
            border: none;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: background-color 0.2s ease-in-out;
        }

        .accordion-header:hover {
            background-color: #ececec;
        }

        .accordion-header .arrow {
            transition: transform 0.2s ease-in-out;
        }

        .accordion-header.active .arrow {
            transform: rotate(180deg);
        }

        .accordion-content {
            padding: 15px;
            background-color: #fff;
            border-top: 1px solid var(--border-color);
            display: none;
        }

        .accordion-content.active {
            display: block;
        }

        #uploadPlanilhaInput,
        #copiarColarTextarea {
            margin-top: 10px;
            margin-bottom: 10px;
        }

        .how-to-use-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .how-to-use-item {
            background-color: #f0f5fa;
            border: 1px dashed #cce0f0;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
        }

        .how-to-use-item h4 {
            font-size: 16px;
            margin-bottom: 10px;
            color: var(--primary-color);
        }

        .how-to-use-item p {
            font-size: 13px;
            color: #555;
            margin-bottom: 15px;
        }

        .how-to-use-item a {
            color: var(--primary-color);
            text-decoration: none;
            font-weight: 500;
        }

        .how-to-use-item a:hover {
            text-decoration: underline;
        }

        .add-product-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            align-items: end;
            margin-bottom: 20px;
            padding: 15px;
            border: 1px solid var(--border-color);
            border-radius: 5px;
            background-color: #fefefe;
        }

        .add-product-grid .input-group {
            margin-bottom: 0;
        }

        .add-product-grid .input-group input[type="text"],
        .add-product-grid .input-group input[type="number"],
        .add-product-grid .input-group select {
            width: 100%;
        }

        .add-product-grid .input-group.full-width {
            grid-column: span 2;
        }

        .add-product-grid .input-group.search-input {
            display: flex;
            align-items: center;
        }
        .add-product-grid .input-group.search-input input {
            border-right: none;
            border-top-right-radius: 0;
            border-bottom-right-radius: 0;
        }
        .add-product-grid .input-group.search-input button {
            border-left: none;
            border-top-left-radius: 0;
            border-bottom-left-radius: 0;
            padding: 10px 12px;
            height: 38px;
        }

        .add-button-container {
            grid-column: span 4;
            text-align: right;
            margin-top: 10px;
        }

        .products-added-section {
            margin-top: 30px;
            border-top: 1px solid var(--border-color);
            padding-top: 20px;
        }

        .products-added-section h3 {
            font-size: 18px;
            margin-bottom: 15px;
            font-weight: 500;
        }

        #noProductsMessage {
            text-align: center;
            color: #888;
            padding: 20px;
            border: 1px dashed var(--border-color);
            border-radius: 5px;
        }

        #addedProductsTable {
            width: 100%;
            margin-top: 15px;
        }

        #addedProductsTable th,
        #addedProductsTable td {
            padding: 10px 8px;
            text-align: left;
            border: 1px solid #eee;
            font-size: 12px;
            word-wrap: break-word;
        }

        #addedProductsTable th {
            background-color: var(--table-header-bg);
            font-weight: 600;
            text-transform: uppercase;
        }

        #addedProductsTable .remove-item-btn {
            background-color: var(--red-alert);
            color: #fff;
            border: none;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            transition: background-color 0.2s ease-in-out;
        }

        #addedProductsTable .remove-item-btn:hover {
            background-color: #c82333;
        }

        .form-actions {
            display: flex;
            justify-content: flex-end; /* Alterado para alinhar √† direita */
            gap: 10px;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid var(--border-color);
        }

        .product-details {
            display: none;
        }

        .validation-message {
            color: var(--red-alert);
            font-size: 13px;
            margin-top: 10px;
            display: none;
        }

        .success-message {
            color: var(--green-success);
            font-size: 13px;
            margin-top: 10px;
            display: none;
        }

        .status-ok { color: var(--green-success); font-weight: bold; }
        .status-warning { color: var(--orange-warning); font-weight: bold; }
        .status-error { color: var(--red-alert); font-weight: bold; }

        .status-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 5px;
        }
        .status-indicator.green { background-color: var(--green-success); }
        .status-indicator.yellow { background-color: var(--orange-warning); }
        .status-indicator.red { background-color: var(--red-alert); }
        .status-indicator.blue { background-color: var(--primary-color); }
        .status-indicator.gray { background-color: var(--secondary-color); }
        .status-indicator.purple { background-color: #800080; }


        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.6);
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal-content {
            background-color: #fff;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            width: 90%;
            max-width: 600px;
            position: relative;
        }

        .modal-close-btn {
            position: absolute;
            top: 10px;
            right: 15px;
            font-size: 24px;
            background: none;
            border: none;
            cursor: pointer;
            color: #888;
        }

        .modal-content h3 {
            margin-bottom: 20px;
            font-size: 20px;
            color: var(--primary-color);
        }

        .modal-content pre {
            background-color: var(--light-gray);
            padding: 15px;
            border-radius: 5px;
            white-space: pre-wrap;
            font-family: monospace;
            font-size: 14px;
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid var(--border-color);
        }

        .modal-content .modal-actions {
            margin-top: 25px;
            text-align: right;
        }

        #productCatalogModal .modal-content {
            max-width: 800px;
        }

        #productCatalogModal .modal-content .search-bar {
            margin-bottom: 15px;
            display: flex;
            gap: 10px;
        }

        #productCatalogModal .modal-content .search-bar input {
            flex-grow: 1;
            padding: 8px;
            border: 1px solid var(--border-color);
            border-radius: 5px;
        }

        #productCatalogModal .modal-content .product-catalog-table-container {
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid var(--border-color);
            border-radius: 5px;
        }

        #productCatalogModal .modal-content .data-table {
            width: 100%;
            border-collapse: collapse;
        }

        #productCatalogModal .modal-content .data-table th,
        #productCatalogModal .modal-content .data-table td {
            padding: 10px;
            border-bottom: 1px solid #eee;
            text-align: left;
            font-size: 13px;
        }

        #productCatalogModal .modal-content .data-table th {
            background-color: #f7f7f7;
            font-weight: 600;
            text-transform: uppercase;
        }

        #productCatalogModal .modal-content .data-table tbody tr:hover {
            background-color: #f5f5f5;
            cursor: pointer;
        }

        .needs-review {
            background-color: #fff3cd !important;
            border: 1px solid #ffc107 !important;
        }

        .summary-section {
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid var(--border-color);
        }

        .summary-section:last-child {
            border-bottom: none;
            padding-bottom: 0;
            margin-bottom: 0;
        }

        .summary-section h2 {
            font-size: 22px;
            font-weight: 600;
            color: var(--primary-color);
            margin-bottom: 20px;
        }

        .supplier-summary-card {
            background-color: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: var(--shadow);
            margin-bottom: 20px;
            border: 1px solid var(--border-color);
            position: relative;
        }

        .supplier-status-indicator {
            position: absolute;
            top: 15px;
            right: 15px;
            font-size: 1.5rem;
        }

        .price-difference-positive {
            color: var(--red-alert);
            font-weight: bold;
        }

        .price-difference-negative {
            color: var(--green-success);
            font-weight: bold;
        }

        .details-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px 20px;
            background-color: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            border: 1px solid var(--border-color);
        }

        .detail-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 5px 0;
            border-bottom: 1px dashed #e9ecef;
        }

        .detail-row:last-child {
            border-bottom: none;
        }

        .detail-label {
            font-weight: 500;
            color: #555;
            flex-basis: 40%;
            text-align: left;
        }

        .detail-value {
            font-weight: 600;
            color: #333;
            flex-basis: 60%;
            text-align: right;
            display: flex;
            justify-content: flex-end;
            align-items: center;
        }

        .tracking-steps {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            padding: 20px 0;
            position: relative;
            background-color: #fff;
            border-radius: 8px;
            box-shadow: var(--shadow);
            overflow-x: auto;
            white-space: nowrap;
            min-height: 120px;
        }

        .tracking-steps::before {
            content: '';
            position: absolute;
            top: 40px;
            left: 20px;
            right: 20px;
            height: 2px;
            background-color: #e0e0e0;
            z-index: 1;
        }

        .tracking-step {
            display: flex;
            flex-direction: column;
            align-items: center;
            flex: 1;
            min-width: 100px;
            position: relative;
            z-index: 2;
            padding: 0 10px;
        }

        .tracking-step .circle {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background-color: #e0e0e0;
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: bold;
            color: #666;
            margin-bottom: 10px;
            flex-shrink: 0;
        }

        .tracking-step span {
            font-size: 12px;
            text-align: center;
            color: #666;
            word-wrap: break-word;
            white-space: normal;
        }

        .tracking-step.completed .circle {
            background-color: var(--green-success);
            color: #fff;
        }
        .tracking-step.active .circle {
            background-color: var(--primary-color);
            color: #fff;
            border: 2px solid var(--primary-color);
            box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.3);
        }
        .tracking-step.pending .circle {
            background-color: var(--orange-warning);
            color: #fff;
        }
        .tracking-step.rejected .circle,
        .tracking-step.cancelled .circle {
            background-color: var(--red-alert);
            color: #fff;
        }
        .tracking-step.approved .circle,
        .tracking-step.production .circle,
        .tracking-step.ready-cargo .circle,
        .tracking-step.atd .circle,
        .tracking-step.pending-doc .circle,
        .tracking-step.doc-ok .circle,
        .tracking-step.ata .circle,
        .tracking-step.finished .circle {
            background-color: var(--green-success);
            color: #fff;
        }
        .tracking-step.negotiation .circle,
        .tracking-step.waiting-approval .circle {
            background-color: var(--orange-warning);
            color: #fff;
        }
        .tracking-step.separation .circle,
        .tracking-step.conference .circle,
        .tracking-step.in-transit .circle,
        .tracking-step.delivered .circle {
            background-color: var(--primary-color);
            color: #fff;
        }

        .tracking-step.completed span {
            color: #333;
            font-weight: 500;
        }
        .tracking-step.active span {
            color: var(--primary-color);
            font-weight: bold;
        }
        .tracking-step.rejected span,
        .tracking-step.cancelled span {
            color: var(--red-alert);
            font-weight: bold;
        }

        /* Styles for Document Viewer Modal */
        #documentViewerModal .modal-content {
            max-width: 90%;
            height: 90%;
            display: flex;
            flex-direction: column;
        }

        /* Removed iframe, now using message element */
        #documentViewerModal .modal-content #documentViewerMessage {
            flex-grow: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1.2rem;
            color: #666;
            text-align: center;
            padding: 20px;
            background-color: #f0f0f0;
            border-radius: 8px;
            border: 1px dashed #ccc;
            flex-direction: column; /* To stack message lines */
        }

        .document-list {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            justify-content: center;
            padding: 20px;
            background-color: #f8f9fa;
            border-radius: 8px;
            border: 1px solid var(--border-color);
        }

        .document-card {
            background-color: #fff;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            box-shadow: var(--shadow);
            padding: 20px;
            text-align: center;
            width: 220px;
            display: flex;
            flex-direction: column;
            align-items: center;
            transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
            cursor: pointer;
        }

        .document-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .document-card .icon {
            font-size: 3rem;
            margin-bottom: 15px;
            color: var(--primary-color);
        }

        .document-card h4 {
            font-size: 1.1rem;
            margin-bottom: 10px;
            color: var(--dark-blue);
        }

        .document-card .btn-view {
            background-color: var(--primary-color);
            color: #fff;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: background-color 0.2s ease-in-out;
        }

        .document-card .btn-view:hover {
            background-color: #0056b3;
        }

        /* Specific styles for Renato Approval Screen table */
        #renatoApprovalScreen .data-table {
            table-layout: fixed; /* Ensures columns respect defined defined widths */
        }

        #renatoApprovalScreen .data-table th,
        #renatoApprovalScreen .data-table td {
            white-space: normal; /* Allow text to wrap */
            word-wrap: break-word; /* Ensure long words break */
            font-size: 12px; /* Slightly smaller font for more content */
            padding: 8px 5px; /* Reduced padding */
            text-align: center; /* Centraliza o texto nas c√©lulas da tabela */
        }

        /* Adjusted column widths for 16 columns total */
        /* PO Section (5 columns - Total 32%) */
        #renatoApprovalScreen .data-table thead th:nth-child(1),
        #renatoApprovalScreen .data-table tbody td:nth-child(1) { width: 5%; } /* PO MODEL */
        #renatoApprovalScreen .data-table thead th:nth-child(2),
        #renatoApprovalScreen .data-table tbody td:nth-child(2) { width: 7%; } /* PO P.N. */
        #renatoApprovalScreen .data-table thead th:nth-child(3),
        #renatoApprovalScreen .data-table tbody td:nth-child(3) { width: 5%; } /* PO QTY */
        #renatoApprovalScreen .data-table thead th:nth-child(4),
        #renatoApprovalScreen .data-table tbody td:nth-child(4) { width: 7.5%; } /* PO UNIT PRICE */
        #renatoApprovalScreen .data-table thead th:nth-child(5),
        #renatoApprovalScreen .data-table tbody td:nth-child(5) { width: 7.5%; } /* PO TOTAL AMOUNT */

        /* PI Section (5 columns - Total 32%) */
        #renatoApprovalScreen .data-table thead th:nth-child(6),
        #renatoApprovalScreen .data-table tbody td:nth-child(6) { width: 5%; } /* PI MODEL */
        #renatoApprovalScreen .data-table thead th:nth-child(7),
        #renatoApprovalScreen .data-table tbody td:nth-child(7) { width: 7%; } /* PI P.N. */
        #renatoApprovalScreen .data-table thead th:nth-child(8),
        #renatoApprovalScreen .data-table tbody td:nth-child(8) { width: 5%; } /* PI QTY */
        #renatoApprovalScreen .data-table thead th:nth-child(9),
        #renatoApprovalScreen .data-table tbody td:nth-child(9) { width: 7.5%; } /* PI UNIT PRICE */
        #renatoApprovalScreen .data-table thead th:nth-child(10),
        #renatoApprovalScreen .data-table tbody td:nth-child(10) { width: 7.5%; } /* PI TOTAL AMOUNT */

        /* Diverg√™ncias Section (6 columns - Total 36%) */
        #renatoApprovalScreen .data-table thead th:nth-child(11),
        #renatoApprovalScreen .data-table tbody td:nth-child(11) { width: 5%; } /* QTY PI/PO */
        #renatoApprovalScreen .data-table thead th:nth-child(12),
        #renatoApprovalScreen .data-table tbody td:nth-child(12) { width: 6%; } /* PRE√áO PI/PO */
        #renatoApprovalScreen .data-table thead th:nth-child(13),
        #renatoApprovalScreen .data-table tbody td:nth-child(13) { width: 6%; } /* MODELO */
        #renatoApprovalScreen .data-table thead th:nth-child(14),
        #renatoApprovalScreen .data-table tbody td:nth-child(14) { width: 6%; } /* P.N. */
        #renatoApprovalScreen .data-table thead th:nth-child(15),
        #renatoApprovalScreen .data-table tbody td:nth-child(15) { width: 5%; } /* % */
        #renatoApprovalScreen .data-table thead th:nth-child(16),
        #renatoApprovalScreen .data-table tbody td:nth-child(16) { width: 8%; } /* A√ß√£o */


        /* Estilos para colorir as colunas de PO e PI */
        #renatoApprovalScreen .data-table .po-header {
            background-color: var(--po-column-bg) !important;
        }
        #renatoApprovalScreen .data-table .pi-header {
            background-color: var(--pi-column-bg) !important;
        }
        #renatoApprovalScreen .data-table .po-column {
            background-color: var(--po-column-bg);
        }
        #renatoApprovalScreen .data-table .pi-column {
            background-color: var(--pi-column-bg);
        }

        /* Styles for the new select element in the "A√ß√£o" column */
        .action-select {
            width: 100%;
            padding: 4px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            font-size: 11px;
            background-color: #fff;
            cursor: pointer;
            outline: none;
            transition: border-color 0.2s ease-in-out;
        }

        .action-select:focus {
            border-color: var(--primary-color);
        }

        /* Removed .approval-buttons-group styles as it's no longer used */

        /* Styles for Flowchart Modal */
        #flowchartModal {
            display: none; /* Hidden by default */
            position: fixed; /* Stay in place */
            z-index: 1001; /* Sit on top */
            left: 0;
            top: 0;
            width: 100%; /* Full width */
            height: 100%; /* Full height */
            overflow: auto; /* Enable scroll if needed */
            background-color: rgba(0,0,0,0.9); /* Black w/ opacity */
            justify-content: center;
            align-items: center;
        }

        #flowchartModal.active {
            display: flex;
        }

        #flowchartModal .modal-content {
            margin: auto;
            display: block;
            width: 90%;
            height: 90%;
            max-width: 1200px; /* Adjust as needed */
            max-height: 800px; /* Adjust as needed */
            background-color: #fff; /* White background for the image */
            padding: 20px;
            border-radius: 8px;
            position: relative;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
        }

        #flowchartModal .modal-content img {
            width: 100%;
            height: 100%;
            object-fit: contain; /* Ensures the image fits within the modal without cropping */
        }

        #flowchartModal .modal-close-btn {
            position: absolute;
            top: 15px;
            right: 25px;
            color: #333; /* Darker color for visibility on white background */
            font-size: 35px;
            font-weight: bold;
            transition: 0.3s;
            background: none;
            border: none;
            cursor: pointer;
            z-index: 1002; /* Ensure close button is above image */
        }

        #flowchartModal .modal-close-btn:hover,
        #flowchartModal .modal-close-btn:focus {
            color: #999;
            text-decoration: none;
            cursor: pointer;
        }

        /* Loader styles */
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid var(--primary-color);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* New styles for enhanced detailed view */
        .po-overview {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 25px;
            padding: 20px;
            background-color: var(--highlight-bg);
            border: 1px solid var(--highlight-border);
            border-radius: 8px;
            box-shadow: var(--shadow);
            flex-wrap: wrap; /* Allow wrapping on smaller screens */
        }

        .po-overview-left,
        .po-overview-right {
            flex: 1;
            min-width: 300px; /* Ensure columns don't get too narrow */
            padding-right: 20px;
        }

        .po-overview-right {
            padding-right: 0;
            padding-left: 20px;
            border-left: 1px solid rgba(0,0,0,0.1); /* Separator */
        }

        .po-overview h3 {
            font-size: 18px;
            color: var(--dark-blue);
            margin-bottom: 10px;
            font-weight: 600;
        }

        .po-overview p {
            font-size: 14px;
            margin-bottom: 5px;
        }

        .po-overview p strong {
            color: var(--text-color);
        }

        .financial-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px dashed var(--border-color);
        }

        .financial-metric {
            text-align: center;
            padding: 10px;
            background-color: #fff;
            border: 1px solid var(--border-color);
            border-radius: 5px;
        }

        .financial-metric .label {
            font-size: 12px;
            color: #666;
            margin-bottom: 5px;
        }

        .financial-metric .value {
            font-size: 18px;
            font-weight: bold;
            color: var(--primary-color);
        }
        .financial-metric .value.positive { color: var(--red-alert); }
        .financial-metric .value.negative { color: var(--green-success); }

        .logistics-commercial-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 25px;
            padding: 20px;
            background-color: #fcfcfc;
            border: 1px solid var(--border-color);
            border-radius: 8px;
        }

        .logistics-commercial-details h4 {
            grid-column: 1 / -1; /* Span all columns */
            font-size: 16px;
            color: var(--dark-blue);
            margin-bottom: 10px;
            font-weight: 600;
        }

        .detail-item {
            margin-bottom: 10px;
        }

        .detail-item .label {
            font-size: 13px;
            color: #555;
            font-weight: 500;
        }

        .detail-item .value {
            font-size: 14px;
            font-weight: bold;
            color: var(--text-color);
        }

        .tracking-timeline {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            padding: 20px 0;
            position: relative;
            background-color: #fff;
            border-radius: 8px;
            box-shadow: var(--shadow);
            overflow-x: auto;
            white-space: nowrap;
            min-height: 120px;
            margin-top: 20px;
            border: 1px solid var(--border-color);
        }

        .tracking-timeline::before {
            content: '';
            position: absolute;
            top: 40px;
            left: 20px;
            right: 20px;
            height: 2px;
            background-color: #e0e0e0;
            z-index: 1;
        }

        .timeline-step {
            display: flex;
            flex-direction: column;
            align-items: center;
            flex: 1;
            min-width: 100px;
            position: relative;
            z-index: 2;
            padding: 0 10px;
        }

        .timeline-step .circle {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background-color: #e0e0e0;
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: bold;
            color: #666;
            margin-bottom: 10px;
            flex-shrink: 0;
        }

        .timeline-step span {
            font-size: 12px;
            text-align: center;
            color: #666;
            word-wrap: break-word;
            white-space: normal;
        }

        .timeline-step.completed .circle {
            background-color: var(--green-success);
            color: #fff;
        }
        .timeline-step.active .circle {
            background-color: var(--primary-color);
            color: #fff;
            border: 2px solid var(--primary-color);
            box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.3);
        }
        .timeline-step.pending .circle {
            background-color: var(--orange-warning);
            color: #fff;
        }
        .timeline-step.rejected .circle,
        .timeline-step.cancelled .circle {
            background-color: var(--red-alert);
            color: #fff;
        }
        .timeline-step.approved .circle,
        .timeline-step.production .circle,
        .timeline-step.ready-cargo .circle,
        .timeline-step.atd .circle,
        .timeline-step.pending-doc .circle,
        .timeline-step.doc-ok .circle,
        .timeline-step.ata .circle,
        .timeline-step.finished .circle {
            background-color: var(--green-success);
            color: #fff;
        }
        .tracking-step.negotiation .circle,
        .tracking-step.waiting-approval .circle {
            background-color: var(--orange-warning);
            color: #fff;
        }
        .tracking-step.separation .circle,
        .tracking-step.conference .circle,
        .tracking-step.in-transit .circle,
        .tracking-step.delivered .circle {
            background-color: var(--primary-color);
            color: #fff;
        }

        .tracking-step.completed span {
            color: #333;
            font-weight: 500;
        }
        .tracking-step.active span {
            color: var(--primary-color);
            font-weight: bold;
        }
        .tracking-step.rejected span,
        .tracking-step.cancelled span {
            color: var(--red-alert);
            font-weight: bold;
        }

        /* Styles for Document Viewer Modal */
        #documentViewerModal .modal-content {
            max-width: 90%;
            height: 90%;
            display: flex;
            flex-direction: column;
        }

        /* Removed iframe, now using message element */
        #documentViewerModal .modal-content #documentViewerMessage {
            flex-grow: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1.2rem;
            color: #666;
            text-align: center;
            padding: 20px;
            background-color: #f0f0f0;
            border-radius: 8px;
            border: 1px dashed #ccc;
            flex-direction: column; /* To stack message lines */
        }

        .document-list {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            justify-content: center;
            padding: 20px;
            background-color: #f8f9fa;
            border-radius: 8px;
            border: 1px solid var(--border-color);
        }

        .document-card {
            background-color: #fff;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            box-shadow: var(--shadow);
            padding: 20px;
            text-align: center;
            width: 220px;
            display: flex;
            flex-direction: column;
            align-items: center;
            transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
            cursor: pointer;
        }

        .document-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .document-card .icon {
            font-size: 3rem;
            margin-bottom: 15px;
            color: var(--primary-color);
        }

        .document-card h4 {
            font-size: 1.1rem;
            margin-bottom: 10px;
            color: var(--dark-blue);
        }

        .document-card .btn-view {
            background-color: var(--primary-color);
            color: #fff;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: background-color 0.2s ease-in-out;
        }

        .document-card .btn-view:hover {
            background-color: #0056b3;
        }

        /* Invoice Simulation Specific Styles */
        #invoicePdfViewerModal .modal-content {
            max-width: 1200px; /* Increased max-width for better invoice display */
            width: 95%; /* Use a percentage for responsiveness */
            height: auto; /* Allow height to adjust to content */
            max-height: 90vh; /* Limit max height to viewport height */
            overflow-y: auto; /* Enable scrolling if content overflows */
            padding: 0; /* Remove padding from modal content to allow invoice content to control it */
        }

        #invoicePdfMessage {
            flex-grow: 1;
            display: block; /* Change to block to allow full HTML rendering */
            justify-content: initial;
            align-items: initial;
            font-size: initial;
            color: initial;
            text-align: initial;
            padding: 0; /* Remove padding from message div, let invoice content handle it */
            background-color: #fff; /* White background for the invoice */
            border-radius: 0; /* No border radius here */
            border: none; /* No border here */
            flex-direction: initial;
        }

        /* Styles for the simulated invoice content */
        .simulated-invoice {
            font-family: 'Roboto', sans-serif;
            font-size: 11px;
            padding: 20px;
            width: 210mm; /* A4 width */
            min-height: 297mm; /* A4 height */
            margin: 0 auto;
            border: 1px solid #ccc; /* Light border around the whole invoice */
            box-shadow: 0 0 5px rgba(0,0,0,0.1);
            background-color: #fff;
            box-sizing: border-box; /* Include padding and border in the element's total width and height */
        }

        .invoice-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 10px;
        }
        .invoice-table th, .invoice-table td {
            border: 1px solid #000;
            padding: 5px;
            font-size: 10px;
            vertical-align: top; /* Align content to top of cell */
            word-wrap: break-word; /* Allow long words to break */
        }
        .invoice-header-cell {
            background-color: #e0e0e0;
            font-weight: bold;
            text-align: center;
        }
        .section-header {
            background-color: #e0e0e0;
            font-weight: bold;
            padding: 5px;
            border: 1px solid #000;
            text-align: left;
            margin-bottom: 5px;
            margin-top: 10px; /* Add some top margin for separation */
        }
        .signature-box {
            border: 1px solid #000;
            padding: 10px;
            height: 80px;
            text-align: center;
            vertical-align: bottom;
            font-size: 10px;
        }
        .logo {
            max-width: 100px;
            height: auto;
            margin-right: 10px;
            vertical-align: middle;
        }
        .invoice-info-box {
            border: 1px solid #000;
            padding: 5px;
            font-size: 10px;
        }
        .text-right { text-align: right; }
        .text-center { text-align: center; }
        .font-bold { font-weight: bold; }
        .flex-container { display: flex; align-items: center; }
        .float-right { float: right; }
        .clear-both { clear: both; }

        /* Specific styles for the new TRANSPORT table format */
        .transport-grid-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 10px;
        }
        .transport-grid-table td {
            border: 1px solid #000;
            padding: 5px;
            font-size: 10px;
            vertical-align: top;
            word-wrap: break-word;
            background-color: #f0f0f0; /* Light gray background for cells */
        }
        .transport-grid-table .label-cell {
            font-weight: bold;
            width: 25%; /* Adjust width as needed */
        }
        .transport-grid-table .value-cell {
            width: 25%; /* Adjust width as needed */
        }
        /* Style for the main TRANSPORT header */
        .transport-main-header {
            background-color: #000; /* Black background */
            color: #fff; /* White text */
            font-weight: bold;
            padding: 5px;
            border: 1px solid #000;
            text-align: center;
            margin-bottom: 5px;
            margin-top: 10px;
        }

    </style>
</head>
<body>

    <div id="renatoApprovalScreen" class="page active">
        <header class="header">
            <div class="header-left">
                <h1>Aprova√ß√£o de Pre√ßos - Gerencial</h1>
                <p>Analise e aprove os pedidos de compra.</p>
            </div>
            <div class="header-right">
                <span class="header-icon" onclick="showScreenInfo()"><i class="icon-question"></i></span>
                <span class="header-icon" onclick="openFlowchartModal()"><i class="icon-flow"></i></span> <!-- Bot√£o Fluxo -->
                <button class="btn-secondary" id="renatoLogoutButton">Sair (Logout)</button>
            </div>
        </header>
        <div class="container">
            <!-- Main Tabs for Renato Approval Screen -->
            <div class="tab-buttons" id="renatoApprovalMainTabs">
                <button class="tab-button active" onclick="switchRenatoApprovalMainTab('pendingApproval')">Aguardando Aprova√ß√£o</button>
                <button class="tab-button" onclick="switchRenatoApprovalMainTab('finalizedOrders')">Pedidos Finalizados</button>
            </div>

            <!-- Content for Main Tabs -->
            <div id="pendingApprovalTab" class="tab-content active">
                <h2 class="text-xl font-semibold mb-4">Pedidos Aguardando Sua Aprova√ß√£o</h2>
                <div class="table-container">
                    <table class="w-full">
                        <thead>
                            <tr>
                                <th>ID SOLICITA√á√ÉO PRINCIPAL</th>
                                <th>N¬∫ PO</th>
                                <th>CLIENTE (NOME)</th>
                                <th>FORNECEDOR (NOME)</th>
                                <th>VALOR TOTAL</th>
                                <th>√öLTIMA ATUALIZA√á√ÉO</th>
                                <th>STATUS</th>
                                <th>A√á√ÉO</th>
                            </tr>
                        </thead>
                        <tbody id="pendingOrdersTableBody">
                        </tbody>
                    </table>
                </div>
            </div>

            <div id="finalizedOrdersTab" class="tab-content">
                <h2 class="text-xl font-semibold mb-4">Pedidos Finalizados</h2>
                <div class="table-container">
                    <table class="w-full">
                        <thead>
                            <tr>
                                <th>ID SOLICITA√á√ÉO PRINCIPAL</th>
                                <th>N¬∫ PO</th>
                                <th>CLIENTE (NOME)</th>
                                <th>FORNECEDOR (NOME)</th>
                                <th>VALOR TOTAL</th>
                                <th>√öLTIMA ATUALIZA√á√ÉO</th>
                                <th>STATUS</th>
                                <th>A√á√ÉO</th>
                            </tr>
                        </thead>
                        <tbody id="finalizedOrdersTableBody">
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Detailed Approval View (now contains sub-tabs) -->
            <div id="detailedApprovalView" class="hidden">
                <h2 class="text-xl font-semibold mb-4">An√°lise Detalhada da PO: <span id="currentDetailedParentOrderIdDisplay"></span></h2>

                <!-- Sub-tabs for Detailed PO View -->
                <div class="tab-buttons" id="detailedPoSubTabs">
                    <button class="tab-button active" onclick="switchDetailedPOTab('general')">Geral</button>
                    <button class="tab-button" onclick="switchDetailedPOTab('documents')">Documentos</button>
                </div>

                <!-- Content for Sub-tabs -->
                <div id="generalTabContent" class="tab-content active">
                    <div id="poAnalysisContent">
                        <!-- Conte√∫do anal√≠tico da PO ser√° renderizado aqui -->
                    </div>
                    <!-- Bot√£o Gerar Invoice movido para c√°, alinhado √† direita -->
                    <div class="form-actions" style="justify-content: flex-end; margin-top: 20px; border-top: none; padding-top: 0;">
                        <button class="btn-primary" id="generateInvoiceBtn" onclick="handleGenerateInvoiceClick()" disabled>Gerar Invoice</button>
                    </div>
                </div>

                <div id="documentsTabContent" class="tab-content">
                    <p class="text-gray-600 mb-6">Selecione o documento que deseja consultar para esta PO.</p>
                    <div id="documentsContent" class="document-list">
                        <!-- Document cards will be rendered here -->
                    </div>
                </div>

                <div class="form-actions mt-6">
                    <button class="btn-secondary" onclick="backToMainList()">Voltar para Lista</button>
                    <button class="btn-primary" id="finalizeApprovalBtn" onclick="handleFinalizeApprovalClick()" disabled>Finalizar Aprova√ß√£o</button>
                </div>
            </div>

            <div id="analysisLoadingScreen" class="modal-overlay">
                <div class="modal-content text-center">
                    <h3>Calculando An√°lise...</h3>
                    <p>Por favor, aguarde enquanto preparamos os dados para aprova√ß√£o.</p>
                    <div class="loader mt-4"></div>
                </div>
            </div>
        </div>
    </div>

    <div id="hongKongFinalScreen" class="page">
        <header class="header">
            <div class="header-left">
                <h1 id="hongKongFinalTitle"></h1>
                <p id="hongKongFinalMessage"></p>
            </div>
            <div class="header-right">
                <span class="header-icon" onclick="showScreenInfo()"><i class="icon-question"></i></span>
                <span class="header-icon" onclick="openFlowchartModal()"><i class="icon-flow"></i></span> <!-- Bot√£o Fluxo -->
            </div>
        </header>
        <div class="container">
            <div class="form-section">
                <h2 class="text-xl font-semibold mb-4">Detalhes da Aprova√ß√£o</h2>
                <div id="finalDetailsHK" class="bg-gray-50 p-4 rounded-lg border border-gray-200">
                </div>
            </div>
            <div class="form-actions">
                <button class="btn-primary" onclick="backToLogin()">Voltar para Login</button>
            </div>
        </div>
    </div>

    <div id="messageModal" class="modal-overlay">
        <div class="modal-content">
            <button class="modal-close-btn" id="messageModalCloseBtn">&times;</button>
            <h3 id="messageModalTitle"></h3>
            <div id="messageModalContent"></div>
            <div class="modal-actions">
                <button class="btn-primary" id="messageModalConfirmBtn">OK</button>
                <button class="btn-secondary" id="messageModalCancelBtn">Cancelar</button>
            </div>
        </div>
    </div>

    <!-- Flowchart Modal Structure -->
    <div id="flowchartModal" class="modal-overlay">
        <div class="modal-content">
            <span class="modal-close-btn" onclick="closeFlowchartModal()">&times;</span>
            <img id="flowchartImage" src="https://raw.githubusercontent.com/SamuelJuniorrr/importexport/refs/heads/main/fluxograma.png" alt="Fluxograma do Processo">
        </div>
    </div>

    <!-- Document Viewer Modal Structure (Simulated) -->
    <div id="documentViewerModal" class="modal-overlay">
        <div class="modal-content">
            <button class="modal-close-btn" onclick="closeDocumentViewerModal()">&times;</button>
            <h3 id="documentViewerTitle"></h3>
            <div id="documentViewerMessage"></div> <!-- Changed from iframe to div for message -->
        </div>
    </div>

    <!-- Invoice PDF Viewer Modal Structure (Simulated) -->
    <div id="invoicePdfViewerModal" class="modal-overlay">
        <div class="modal-content">
            <button class="modal-close-btn" onclick="closeInvoicePdfViewerModal()">&times;</button>
            <h3 style="margin-bottom: 10px;">Visualizando Invoice</h3>
            <div id="invoicePdfMessage">
                <!-- Simulated Invoice HTML will be injected here -->
            </div>
            <div class="modal-actions" style="justify-content: center; margin-top: 15px;">
                <button class="btn-primary" onclick="simulateDocSign()">Simular Assinatura (DocSign)</button>
            </div>
        </div>
    </div>

    <script>
        let currentScreen = 'renatoApprovalScreen'; // Define a tela inicial como a de aprova√ß√£o do gestor
        let currentViewingPO = null; // PO atualmente selecionada para detalhes de aprova√ß√£o

        // Constantes para c√°lculo de cubagem de containers
        const MAX_CUBAGE_20HC = 37.4; // Capacidade m√°xima de um container de 20HC em m¬≥
        const MAX_CUBAGE_40HC = 76.0; // Capacidade m√°xima de um container de 40HC em m¬≥

        // Dados simulados das Ordens de Compra (POs)
        // Adicionadas informa√ß√µes de currentInternalSalePrice e statusHistory
        // Adicionados piQuantity, piModel e piPN para simular diverg√™ncias
        let generatedPurchaseOrders = [
            {
                parentOrderId: 'SOL-001', id: 'PED-001', supplier: 'Fornecedor A', supplierCode: '22', date: '2025-06-20',
                products: [
                    { code: 'PROD001', name: 'Smartphone Premium X1', quantity: 10, piQuantity: 9, piModel: 'PROD001-B', piPN: 'PROD001', currentInternalUnitPrice: 160.00, newSupplierUnitPrice: 155.00, approvalStatus: 'Pendente', cubageUnit: 0.005, currentInternalSalePrice: 220.00, targetProfitMarginPercent: 25 }
                ],
                newSupplierPriceTotal: (10 * 155).toFixed(2), currentInternalPriceTotal: (10 * 160).toFixed(2), overallApprovalStatus: 'Aguardando Aprova√ß√£o',
                totalCubage: (10 * 0.005).toFixed(2), originCountry: 'Hong Kong', lastUpdateDate: '2025-06-20',
                clientName: 'Cliente Mexico', billTo: 'Rua Exemplo, 123', shipTo: 'Av. Teste, 456', clientEmail: 'cliente.mexico@example.com',
                orderNumber: 'AG 03/25 TYBR', supplierEmail: 'fornecedorA@example.com', terms: '20% TT balance after BL - FOB Ningbo Port', freight: '1 X 40ft regular Container', etd: '2025-05-20', eta: '2025-05-04',
                clientCnpj: '03.817.469/0003-78', clientAddress: 'BR 470 - INGO HERING, N¬∫ 4, BAIRRO S√ÉO DOMINGOS, 88370-888 - NAVEGANTES, SC, BRASIL', clientShipAddress: 'BR 470 - INGO HERING, N¬∫ 4, BAIRRO S√ÉO DOMINGOS, 88370-888 - NAVEGANTES, SC, BRASIL',
                portDestination: 'Navegantes Port, Brazil',
                statusHistory: [
                    { status: 'Solicitado', date: '2025-06-15' },
                    { status: 'Em Negocia√ß√£o', date: '2025-06-18' },
                    { status: 'Aguardando Aprova√ß√£o', date: '2025-06-20' }
                ]
            },
            {
                parentOrderId: 'SOL-014', id: 'PED-017', supplier: 'Fornecedor C', supplierCode: '44', date: '2025-06-30',
                products: [
                    { code: 'PROD003', name: 'Fone Bluetooth Max', quantity: 20, piQuantity: 22, piModel: 'PROD003', piPN: 'PROD003-Y', currentInternalUnitPrice: 48.00, newSupplierUnitPrice: 42.00, approvalStatus: 'Pendente', cubageUnit: 0.001, currentInternalSalePrice: 60.00, targetProfitMarginPercent: 30 }
                ],
                newSupplierPriceTotal: (20 * 42).toFixed(2), currentInternalPriceTotal: (20 * 48).toFixed(2), overallApprovalStatus: 'Aguardando Aprova√ß√£o',
                totalCubage: (20 * 0.001).toFixed(2), originCountry: 'Hong Kong', lastUpdateDate: '2025-06-30',
                clientName: 'Cliente Chile', billTo: 'Calle Falsa, 123', shipTo: 'Av. Siempre Viva, 742', clientEmail: 'cliente.chile@example.com',
                orderNumber: 'AG 04/25 TYBR', supplierEmail: 'fornecedorC@example.com', terms: 'Net 60', freight: 'CIF Hong Kong', etd: '2025-06-20', eta: '2025-07-05',
                clientCnpj: '03.817.469/0003-78', clientAddress: 'Rua Exemplo, 123', clientShipAddress: 'Av. Teste, 456',
                portDestination: 'Navegantes Port, Brazil',
                statusHistory: [
                    { status: 'Solicitado', date: '2025-06-25' },
                    { status: 'Em Negocia√ß√£o', date: '2025-06-28' },
                    { status: 'Aguardando Aprova√ß√£o', date: '2025-06-30' }
                ]
            },
            {
                parentOrderId: 'SOL-003', id: 'PED-005', supplier: 'Fornecedor B', supplierCode: '33', date: '2025-06-24',
                products: [
                    { code: 'PROD001', name: 'Smartphone Premium X1', quantity: 2, piQuantity: 2, piModel: 'PROD001', piPN: 'PROD001', currentInternalUnitPrice: 158.00, newSupplierUnitPrice: 152.00, approvalStatus: 'Pendente', cubageUnit: 0.005, currentInternalSalePrice: 210.00, targetProfitMarginPercent: 20 },
                    { code: 'PROD003', name: 'Fone Bluetooth Max', quantity: 3, piQuantity: 3, piModel: 'PROD003', piPN: 'PROD003', currentInternalUnitPrice: 48.00, newSupplierUnitPrice: 46.00, approvalStatus: 'Pendente', cubageUnit: 0.001, currentInternalSalePrice: 65.00, targetProfitMarginPercent: 28 }
                ],
                newSupplierPriceTotal: (2 * 152 + 3 * 46).toFixed(2), currentInternalPriceTotal: (2 * 158 + 3 * 48).toFixed(2), overallApprovalStatus: 'Negociado',
                totalCubage: (2 * 0.005 + 3 * 0.001).toFixed(2), originCountry: 'Hong Kong', lastUpdateDate: '2025-07-01',
                clientName: 'Cliente Paraguai', billTo: 'Rua Principal, 1', shipTo: 'Av. Secund√°ria, 2', clientEmail: 'cliente.paraguai@example.com',
                orderNumber: 'PO-9876', supplierEmail: 'fornecedorB@example.com', terms: 'Net 30', freight: 'EXW Hong Kong', etd: '2025-07-05', eta: '2025-07-20',
                clientCnpj: '03.817.469/0003-78', clientAddress: 'Rua Principal, 1', clientShipAddress: 'Av. Secund√°ria, 2',
                portDestination: 'Navegantes Port, Brazil',
                statusHistory: [
                    { status: 'Solicitado', date: '2025-06-20' },
                    { status: 'Em Negocia√ß√£o', date: '2025-06-22' },
                    { status: 'Aguardando Aprova√ß√£o', date: '2025-06-24' },
                    { status: 'Negociado', date: '2025-07-01' }
                ]
            },
            {
                parentOrderId: 'SOL-015', id: 'PED-018', supplier: 'Fornecedor A', supplierCode: '22', date: '2025-06-29',
                products: [
                    { code: 'PROD004', name: 'Smartwatch Sport Y', quantity: 5, piQuantity: 5, piModel: 'PROD004', piPN: 'PROD004', currentInternalUnitPrice: 85.00, newSupplierUnitPrice: 82.00, approvalStatus: 'Pendente', cubageUnit: 0.002, currentInternalSalePrice: 110.00, targetProfitMarginPercent: 22 }
                ],
                newSupplierPriceTotal: (5 * 82).toFixed(2), currentInternalPriceTotal: (5 * 85).toFixed(2), overallApprovalStatus: 'Negociado',
                totalCubage: (5 * 0.002).toFixed(2), originCountry: 'Hong Kong', lastUpdateDate: '2025-07-01',
                clientName: 'Cliente Mexico', billTo: 'Rua Exemplo, 123', shipTo: 'Av. Teste, 456', clientEmail: 'cliente.mexico@example.com',
                orderNumber: 'PO-5432', supplierEmail: 'fornecedorA@example.com', terms: 'Net 30', freight: 'FOB Hong Kong', etd: '2025-07-10', eta: '2025-07-25',
                clientCnpj: '03.817.469/0003-78', clientAddress: 'Rua Exemplo, 123', clientShipAddress: 'Av. Teste, 456',
                portDestination: 'Navegantes Port, Brazil',
                statusHistory: [
                    { status: 'Solicitado', date: '2025-06-25' },
                    { status: 'Em Negocia√ß√£o', date: '2025-06-27' },
                    { status: 'Aguardando Aprova√ß√£o', date: '2025-06-29' },
                    { status: 'Negociado', date: '2025-07-01' }
                ]
            },
            {
                parentOrderId: 'SOL-008', id: 'PED-015', supplier: 'Fornecedor A', supplierCode: '22', date: '2025-06-29',
                products: [
                    { code: 'PROD001', name: 'Smartphone Premium X1', quantity: 5, piQuantity: 5, piModel: 'PROD001', piPN: 'PROD001', currentInternalUnitPrice: 158.00, newSupplierUnitPrice: 152.00, approvalStatus: 'Pendente', cubageUnit: 0.005, currentInternalSalePrice: 210.00, targetProfitMarginPercent: 20 }
                ],
                newSupplierPriceTotal: (5 * 152).toFixed(2), currentInternalPriceTotal: (5 * 158).toFixed(2), overallApprovalStatus: 'Aguardando Aprova√ß√£o',
                totalCubage: (5 * 0.005).toFixed(2), originCountry: 'Hong Kong', lastUpdateDate: '2025-07-02',
                clientName: 'Cliente Chile', billTo: 'Calle Falsa, 123', shipTo: 'Av. Sempre Viva, 742', clientEmail: 'cliente.chile@example.com',
                orderNumber: 'PO-1122', supplierEmail: 'fornecedorA@example.com', terms: 'Net 30', freight: 'FOB Hong Kong', etd: '2025-07-15', eta: '2025-07-30',
                clientCnpj: '03.817.469/0003-78', clientAddress: 'Calle Falsa, 123', clientShipAddress: 'Av. Sempre Viva, 742',
                portDestination: 'Navegantes Port, Brazil',
                statusHistory: [
                    { status: 'Solicitado', date: '2025-06-26' },
                    { status: 'Em Negocia√ß√£o', date: '2025-06-28' },
                    { status: 'Aguardando Aprova√ß√£o', date: '2025-06-29' }
                ]
            },
            {
                parentOrderId: 'SOL-008', id: 'PED-016', supplier: 'Fornecedor B', supplierCode: '33', date: '2025-06-29',
                products: [
                    { code: 'PROD002', name: 'Tablet Pro Z', quantity: 2, piQuantity: 2, piModel: 'PROD002', piPN: 'PROD002', currentInternalUnitPrice: 260.00, newSupplierUnitPrice: 255.00, approvalStatus: 'Pendente', cubageUnit: 0.008, currentInternalSalePrice: 350.00, targetProfitMarginPercent: 25 }
                ],
                newSupplierPriceTotal: (2 * 255).toFixed(2), currentInternalPriceTotal: (2 * 260).toFixed(2), overallApprovalStatus: 'Aguardando Aprova√ß√£o',
                totalCubage: (2 * 0.008).toFixed(2), originCountry: 'Hong Kong', lastUpdateDate: '2025-07-02',
                clientName: 'Cliente Paraguai', billTo: 'Rua Principal, 1', shipTo: 'Av. Secund√°ria, 2', clientEmail: 'cliente.paraguai@example.com',
                orderNumber: 'PO-3344', supplierEmail: 'fornecedorB@example.com', terms: 'Net 30', freight: 'EXW Hong Kong', etd: '2025-07-10', eta: '2025-07-25',
                clientCnpj: '03.817.469/0003-78', clientAddress: 'Rua Principal, 1', clientShipAddress: 'Av. Secund√°ria, 2',
                portDestination: 'Navegantes Port, Brazil',
                statusHistory: [
                    { status: 'Solicitado', date: '2025-06-26' },
                    { status: 'Em Negocia√ß√£o', date: '2025-06-28' },
                    { status: 'Aguardando Aprova√ß√£o', date: '2025-06-29' }
                ]
            },
            {
                parentOrderId: 'SOL-016', id: 'PED-019', supplier: 'Fornecedor B', supplierCode: '33', date: '2025-06-30',
                products: [
                    { code: 'PROD005', name: 'C√¢mera Digital Ultra HD', quantity: 1, piQuantity: 1, piModel: 'PROD005', piPN: 'PROD005', currentInternalUnitPrice: 320.00, newSupplierUnitPrice: 310.00, approvalStatus: 'Pendente', cubageUnit: 0.01, currentInternalSalePrice: 400.00, targetProfitMarginPercent: 20 }
                ],
                newSupplierPriceTotal: (1 * 310).toFixed(2), currentInternalPriceTotal: (1 * 320).toFixed(2), overallApprovalStatus: 'Aguardando Aprova√ß√£o',
                totalCubage: (1 * 0.01).toFixed(2), originCountry: 'Hong Kong', lastUpdateDate: '2025-07-02',
                clientName: 'Cliente Mexico', billTo: 'Rua Exemplo, 123', shipTo: 'Av. Teste, 456', clientEmail: 'cliente.mexico@example.com',
                orderNumber: 'PO-5566', supplierEmail: 'fornecedorB@example.com', terms: 'Net 30', freight: 'FOB Hong Kong', etd: '2025-07-15', eta: '2025-07-30',
                clientCnpj: '03.817.469/0003-78', clientAddress: 'Rua Exemplo, 123', clientShipAddress: 'Av. Teste, 456',
                portDestination: 'Navegantes Port, Brazil',
                statusHistory: [
                    { status: 'Solicitado', date: '2025-06-27' },
                    { status: 'Em Negocia√ß√£o', date: '2025-06-29' },
                    { status: 'Aguardando Aprova√ß√£o', date: '2025-06-30' }
                ]
            },
            {
                parentOrderId: 'SOL-020', id: 'PED-021', supplier: 'Fornecedor A', supplierCode: '22', date: '2025-07-01',
                products: [
                    { code: 'PROD004', name: 'Smartwatch Sport Y', quantity: 3, piQuantity: 3, piModel: 'PROD004', piPN: 'PROD004', currentInternalUnitPrice: 85.00, newSupplierUnitPrice: 88.00, approvalStatus: 'Rejeitar', cubageUnit: 0.002, currentInternalSalePrice: 110.00, targetProfitMarginPercent: 22 }
                ],
                newSupplierPriceTotal: (3 * 88).toFixed(2), currentInternalPriceTotal: (3 * 85).toFixed(2), overallApprovalStatus: 'Rejeitado',
                totalCubage: (3 * 0.002).toFixed(2), originCountry: 'Hong Kong', lastUpdateDate: '2025-07-03',
                clientName: 'Cliente Chile', billTo: 'Calle Falsa, 123', shipTo: 'Av. Sempre Viva, 742', clientEmail: 'cliente.chile@example.com',
                orderNumber: 'PO-7788', supplierEmail: 'fornecedorA@example.com', terms: 'Net 30', freight: 'CIF Hong Kong', etd: '2025-07-05', eta: '2025-07-20',
                clientCnpj: '03.817.469/0003-78', clientAddress: 'Calle Falsa, 123', clientShipAddress: 'Av. Sempre Viva, 742',
                portDestination: 'Navegantes Port, Brazil',
                statusHistory: [
                    { status: 'Solicitado', date: '2025-06-28' },
                    { status: 'Em Negocia√ß√£o', date: '2025-06-30' },
                    { status: 'Aguardando Aprova√ß√£o', date: '2025-07-01' },
                    { status: 'Rejeitado', date: '2025-07-03' }
                ]
            },
            {
                parentOrderId: 'SOL-005', id: 'PED-010', supplier: 'Fornecedor C', supplierCode: '44', date: '2025-06-26',
                products: [
                    { code: 'PROD005', name: 'C√¢mera Digital Ultra HD', quantity: 3, piQuantity: 3, piModel: 'PROD005', piPN: 'PROD005', currentInternalUnitPrice: 335.00, newSupplierUnitPrice: 320.00, approvalStatus: 'Aprovado', cubageUnit: 0.01, currentInternalSalePrice: 450.00, targetProfitMarginPercent: 25 }
                ],
                newSupplierPriceTotal: (3 * 320).toFixed(2), currentInternalPriceTotal: (3 * 335).toFixed(2), overallApprovalStatus: 'Aprovado',
                totalCubage: (3 * 0.01).toFixed(2), originCountry: 'Hong Kong', lastUpdateDate: '2025-07-03',
                clientName: 'Cliente Paraguai', billTo: 'Rua Principal, 1', shipTo: 'Av. Secund√°ria, 2', clientEmail: 'cliente.paraguai@example.com',
                orderNumber: 'PO-9900', supplierEmail: 'fornecedorC@example.com', terms: 'Net 60', freight: 'EXW Hong Kong', etd: '2025-07-01', eta: '2025-07-15',
                clientCnpj: '03.817.469/0003-78', clientAddress: 'Rua Principal, 1', clientShipAddress: 'Av. Secund√°ria, 2',
                portDestination: 'Navegantes Port, Brazil',
                statusHistory: [
                    { status: 'Solicitado', date: '2025-06-20' },
                    { status: 'Em Negocia√ß√£o', date: '2025-06-23' },
                    { status: 'Aguardando Aprova√ß√£o', date: '2025-06-26' },
                    { status: 'Aprovado', date: '2025-07-03' }
                ]
            },
            {
                parentOrderId: 'SOL-009', id: 'PED-002', supplier: 'Fornecedor B', supplierCode: '33', date: '2025-06-21',
                products: [
                    { code: 'PROD007', name: 'Cadeira Ergon√¥mica', quantity: 2, piQuantity: 2, piModel: 'PROD007', piPN: 'PROD007', currentInternalUnitPrice: 630.00, newSupplierUnitPrice: 600.00, approvalStatus: 'Aprovado', cubageUnit: 0.15, currentInternalSalePrice: 800.00, targetProfitMarginPercent: 20 }
                ],
                newSupplierPriceTotal: (2 * 600).toFixed(2), currentInternalPriceTotal: (2 * 630).toFixed(2), overallApprovalStatus: 'Aprovado',
                totalCubage: (2 * 0.15).toFixed(2), originCountry: 'Col√¥mbia', lastUpdateDate: '2025-07-01',
                clientName: 'Cliente Colombia', billTo: 'Carrera 10, 10-10', shipTo: 'Avenida 20, 20-20', clientEmail: 'cliente.colombia@example.com',
                orderNumber: 'PO-1234', supplierEmail: 'fornecedorB@example.com', terms: 'Net 30', freight: 'FOB Colombia', etd: '2025-06-25', eta: '2025-07-01',
                clientCnpj: '03.817.469/0003-78', clientAddress: 'Carrera 10, 10-10', clientShipAddress: 'Avenida 20, 20-20',
                portDestination: 'Cartagena Port, Colombia',
                statusHistory: [
                    { status: 'Solicitado', date: '2025-06-15' },
                    { status: 'Em Negocia√ß√£o', date: '2025-06-18' },
                    { status: 'Aguardando Aprova√ß√£o', date: '2025-06-20' },
                    { status: 'Aprovado', date: '2025-07-01' }
                ]
            },
            {
                parentOrderId: 'SOL-017', id: 'PED-020', supplier: 'Fornecedor A', supplierCode: '22', date: '2025-06-25',
                products: [
                    { code: 'PROD006', name: 'Bateria Port√°til Mega', quantity: 15, piQuantity: 15, piModel: 'PROD006', piPN: 'PROD006', currentInternalUnitPrice: 28.00, newSupplierUnitPrice: 22.00, approvalStatus: 'Aprovado', cubageUnit: 0.0005, currentInternalSalePrice: 40.00, targetProfitMarginPercent: 30 }
                ],
                newSupplierPriceTotal: (15 * 22).toFixed(2), currentInternalPriceTotal: (15 * 28).toFixed(2), overallApprovalStatus: 'Finalizado',
                totalCubage: (15 * 0.0005).toFixed(2), originCountry: 'Hong Kong', lastUpdateDate: '2025-07-05',
                clientName: 'Cliente Mexico', billTo: 'Rua Exemplo, 123', shipTo: 'Av. Teste, 456', clientEmail: 'cliente.mexico@example.com',
                orderNumber: 'PO-4321', supplierEmail: 'fornecedorA@example.com', terms: 'Net 30', freight: 'FOB Hong Kong', etd: '2025-06-28', eta: '2025-07-10',
                clientCnpj: '03.817.469/0003-78', clientAddress: 'Rua Exemplo, 123', clientShipAddress: 'Av. Teste, 456',
                portDestination: 'Navegantes Port, Brazil',
                statusHistory: [
                    { status: 'Solicitado', date: '2025-06-20' },
                    { status: 'Em Negocia√ß√£o', date: '2025-06-22' },
                    { status: 'Aguardando Aprova√ß√£o', date: '2025-06-25' },
                    { status: 'Aprovado', date: '2025-07-01' },
                    { status: 'Finalizado', date: '2025-07-05' }
                ]
            },
            {
                parentOrderId: 'SOL-018', id: 'SAP-001', supplier: 'Fornecedor C', supplierCode: '44', date: '2025-07-01',
                products: [
                    { code: 'PROD009', name: 'Monitor Ultrawide', quantity: 1, piQuantity: 1, piModel: 'PROD009', piPN: 'PROD009', currentInternalUnitPrice: 350.00, newSupplierUnitPrice: 350.00, approvalStatus: 'Aprovado', cubageUnit: 0.05, currentInternalSalePrice: 500.00, targetProfitMarginPercent: 30 },
                    { code: 'PROD003', name: 'Fone Bluetooth Max', quantity: 3, piQuantity: 3, piModel: 'PROD003', piPN: 'PROD003', currentInternalUnitPrice: 50.00, newSupplierUnitPrice: 50.00, approvalStatus: 'Aprovado', cubageUnit: 0.001, currentInternalSalePrice: 70.00, targetProfitMarginPercent: 28 }
                ],
                newSupplierPriceTotal: (1 * 350 + 3 * 50).toFixed(2), currentInternalPriceTotal: (1 * 350 + 3 * 50).toFixed(2), overallApprovalStatus: 'Em Separa√ß√£o',
                totalCubage: (1 * 0.05 + 3 * 0.001).toFixed(2), originCountry: 'Col√¥mbia', lastUpdateDate: '2025-07-05',
                clientName: 'Cliente Colombia', billTo: 'Carrera 10, 10-10', shipTo: 'Avenida 20, 20-20', clientEmail: 'cliente.colombia@example.com',
                orderNumber: 'SAP-9876', supplierEmail: 'fornecedorC@example.com', terms: 'Cash', freight: 'Terrestre', etd: '2025-07-02', eta: '2025-07-05',
                clientCnpj: '03.817.469/0003-78', clientAddress: 'Carrera 10, 10-10', clientShipAddress: 'Avenida 20, 20-20',
                portDestination: 'Cartagena Port, Colombia',
                statusHistory: [
                    { status: 'Solicitado', date: '2025-06-25' },
                    { status: 'Em Negocia√ß√£o', date: '2025-06-28' },
                    { status: 'Aguardando Aprova√ß√£o', date: '2025-07-01' },
                    { status: 'Aprovado', date: '2025-07-02' },
                    { status: 'Em Separa√ß√£o', date: '2025-07-05' }
                ]
            }
        ];

        // Mapa para gerenciar c√≥digos e nomes de fornecedores (simulado)
        const supplierCodeMap = {};
        const supplierNameMap = {};
        let nextSupplierCode = 22; // C√≥digo inicial para novos fornecedores

        /**
         * Retorna o c√≥digo do fornecedor ou gera um novo se n√£o existir.
         * @param {string} supplierName Nome do fornecedor.
         * @returns {string} C√≥digo do fornecedor.
         */
        function getOrGenerateSupplierCode(supplierName) {
            if (!supplierCodeMap[supplierName]) {
                let maxCode = 0;
                for (const key in supplierCodeMap) {
                    maxCode = Math.max(maxCode, parseInt(supplierCodeMap[key]));
                }
                nextSupplierCode = maxCode + 11; // Incrementa o c√≥digo para o pr√≥ximo fornecedor
                supplierCodeMap[supplierName] = String(nextSupplierCode);
                supplierNameMap[String(nextSupplierCode)] = supplierName;
            }
            return supplierCodeMap[supplierName];
        }

        /**
         * Exibe uma tela espec√≠fica e oculta as outras.
         * @param {string} screenId O ID da tela a ser exibida.
         */
        function showScreen(screenId) {
            document.querySelectorAll('.page').forEach(screen => {
                screen.classList.remove('active');
            });
            document.getElementById(screenId).classList.add('active');
            currentScreen = screenId;
        }

        /**
         * Exibe um modal de mensagem gen√©rico.
         * @param {string} title T√≠tulo do modal.
         * @param {string} content Conte√∫do HTML do modal.
         * @param {string} type Tipo de mensagem ('info', 'success', 'error').
         * @param {function} onConfirm Callback para o bot√£o OK/Confirmar.
         * @param {function} onCancel Callback para o bot√£o Cancelar.
         */
        function showMessage(title, content, type = 'info', onConfirm = null, onCancel = null) {
            const modal = document.getElementById('messageModal');
            document.getElementById('messageModalTitle').innerText = title;
            document.getElementById('messageModalContent').innerHTML = content;
            const confirmBtn = document.getElementById('messageModalConfirmBtn');
            const cancelBtn = document.getElementById('messageModalCancelBtn');
            const closeBtn = document.getElementById('messageModalCloseBtn');

            // Define os callbacks para os bot√µes do modal
            confirmBtn.onclick = () => { if (onConfirm) onConfirm(); modal.classList.remove('active'); };
            cancelBtn.onclick = () => { if (onCancel) onCancel(); modal.classList.remove('active'); };
            closeBtn.onclick = () => modal.classList.remove('active');

            // Oculta/exibe bot√µes com base na presen√ßa de callbacks
            confirmBtn.classList.add('hidden');
            cancelBtn.classList.add('hidden');
            closeBtn.classList.remove('hidden');

            if (onConfirm || onCancel) {
                closeBtn.classList.add('hidden');
                confirmBtn.classList.remove('hidden');
                if (onCancel) {
                    cancelBtn.classList.remove('hidden');
                }
            }
            modal.classList.add('active'); // Exibe o modal
        }

        /**
         * Exibe informa√ß√µes contextuais sobre a tela atual.
         */
        function showScreenInfo() {
            let info = '';
            switch (currentScreen) {
                case 'renatoApprovalScreen':
                    info = `
                        <h2 style="font-size:1.3rem; font-weight:bold; margin-bottom:10px;">üëî Aprova√ß√£o de Pre√ßos - Gerencial</h2>
                        <p>Esta tela √© o seu painel de controle para gerenciar e aprovar as Ordens de Compra (POs).</p>
                        <hr style="margin:16px 0;">
                        <h3 style="font-size:1.1rem; font-weight:bold; margin-bottom:8px;">Funcionalidades Principais:</h3>
                        <ul style="margin-bottom:10px; list-style-type: disc; margin-left: 20px;">
                            <li><b>An√°lise de POs Pendentes:</b> Visualize e priorize os pedidos que aguardam sua decis√£o.</li>
                            <li><b>Comparativo de Pre√ßos:</b> Compare de forma clara os valores internos dos produtos com os pre√ßos negociados pelos fornecedores, identificando rapidamente oportunidades de economia ou desvios.</li>
                            <li><b>Decis√£o por Produto:</b> Para cada item na PO, voc√™ pode:
                                <ul>
                                    <li>‚úÖ <b>Aprovar:</b> Aceita o pre√ßo negociado e permite que o processo avance.</li>
                                    <li>üîÑ <b>Negociar:</b> Indica que o pre√ßo precisa de uma nova rodada de negocia√ß√£o pela equipe de compras.</li>
                                    <li>‚ùå <b>Rejeitar:</b> Recusa o produto ou pre√ßo, encerrando o processo para aquele item.</li>
                                </ul>
                            </li>
                            <li><b>Vis√£o Gerencial:</b> Tenha acesso a m√©tricas importantes como diferen√ßa de custo, lucro bruto estimado e margem de lucro por produto, auxiliando na tomada de decis√µes estrat√©gicas.</li>
                            <li><b>Hist√≥rico de Status:</b> Acompanhe a linha do tempo de cada PO, desde a solicita√ß√£o at√© o status atual.</li>
                            <li><b>Documentos:</b> Acesse documentos relacionados √† PO, como solicita√ß√£o do cliente, PO de compras e PI do fornecedor.</li>
                        </ul>
                        <hr style="margin:16px 0;">
                        <p style="font-size:0.95rem;"><b>Dica:</b> Utilize os √≠cones de a√ß√£o na tabela para definir o status de cada produto. Certifique-se de que todos os produtos tenham um status definido antes de "Finalizar Aprova√ß√£o".</p>
                    `;
                    break;
                case 'hongKongFinalScreen':
                    info = `
                        <h2 style="font-size:1.3rem; font-weight:bold; margin-bottom:10px;">‚úÖ Aprova√ß√£o Finalizada</h2>
                        <p>Esta tela exibe o resultado final da sua aprova√ß√£o.</p>
                        <hr style="margin:16px 0;">
                        <ul style="margin-bottom:10px;">
                        <li>Confira o resumo dos produtos aprovados, rejeitados ou para renegocia√ß√£o.</li>
                        <li>O sistema atualizar√° o status da PO e notificar√° as equipes relevantes.</li>
                        </ul>
                        <hr style="margin:16px 0;">
                        <p style="font-size:0.95rem;"><b>Dica:</b> Voc√™ pode voltar para a lista de pedidos para continuar revisando outras POs.</p>
                    `;
                    break;
                default:
                    info = '<p>Esta tela faz parte do fluxo do portal. Para mais informa√ß√µes, consulte o manual ou o suporte.</p>';
            }
            showMessage('Informa√ß√µes da Tela', info, 'info');
        }

        /**
         * Simula o logout, retornando para a p√°gina de login.
         */
        function logout() {
            currentViewingPO = null;
            // Em um ambiente real, aqui voc√™ faria a limpeza de sess√£o, etc.
            // Para este prot√≥tipo, vamos apenas simular um retorno √† tela de login.
            window.location.href = 'index.html'; // Redireciona para a p√°gina de login
        }

        /**
         * Retorna a classe CSS para o indicador de status com base no status fornecido.
         * @param {string} status O status da PO ou produto.
         * @returns {string} A classe CSS correspondente.
         */
        function getStatusClass(status) {
            switch (status) {
                case 'Aprovado':
                case 'Finalizado':
                case 'Em Produ√ß√£o':
                case 'Carga Pronta':
                case 'Sa√≠da do Porto de Embarque (ATD)':
                case 'Documenta√ß√£o OK':
                case 'Chegada no Porto de Destino (ATA)':
                case 'Entregue':
                case 'Em Separa√ß√£o':
                case 'Em Confer√™ncia':
                case 'Em Rota de Entrega':
                    return 'green';
                case 'Pendente':
                case 'Aguardando Aprova√ß√£o':
                case 'Documenta√ß√£o Pendente':
                    return 'yellow';
                case 'Rejeitado':
                case 'Cancelado':
                    return 'red';
                case 'Negociar': /* Changed from Negociado to Negociar to match dropdown option */
                    return 'purple';
                case 'Solicitado': // New status for tracking
                case 'Em Negocia√ß√£o':
                    return 'gray';
                default:
                    return 'yellow';
            }
        }

        /**
         * Renderiza a tabela de POs para a tela de aprova√ß√£o do gestor.
         * @param {string} tbodyId O ID do tbody da tabela a ser preenchida.
         * @param {Array<Object>} filteredPOs A lista de POs a serem exibidas.
         * @param {string} actionButtonText O texto do bot√£o de a√ß√£o.
         * @param {string} actionButtonFunction O nome da fun√ß√£o a ser chamada no clique do bot√£o.
         */
        function renderPOTable(tbodyId, filteredPOs, actionButtonText, actionButtonFunction) {
            const tbody = document.getElementById(tbodyId);
            if (!tbody) {
                console.error(`Error: tbody with ID '${tbodyId}' not found.`);
                return;
            }
            tbody.innerHTML = '';

            if (filteredPOs.length === 0) {
                tbody.innerHTML = `<tr><td colspan="8" class="text-center py-4 text-gray-500">Nenhum pedido encontrado.</td></tr>`;
                return;
            }

            filteredPOs.forEach(po => {
                const row = document.createElement('tr');
                // Simula o nome do cliente, pois n√£o temos o objeto 'orders' globalmente aqui
                const clientName = po.clientName || 'Cliente Desconhecido';
                const supplierName = po.supplier || 'N/A';
                const lastUpdateDate = po.lastUpdateDate || po.date;
                
                let statusIndicatorClass = getStatusClass(po.overallApprovalStatus);

                let actionButtonHtml = '';
                if (actionButtonFunction) {
                    actionButtonHtml = `<button onclick="${actionButtonFunction}('${po.id}')" class="btn btn-primary btn-sm">${actionButtonText}</button>`;
                }

                row.innerHTML = `
                    <td>${po.parentOrderId || 'N/A'}</td>
                    <td>${po.id}</td>
                    <td>${clientName}</td>
                    <td>${supplierName}</td>
                    <td>$ ${parseFloat(po.newSupplierPriceTotal).toFixed(2).replace('.', ',')}</td>
                    <td>${lastUpdateDate}</td>
                    <td><span class="status-indicator ${statusIndicatorClass}"></span>${po.overallApprovalStatus}</td>
                    <td>${actionButtonHtml}</td>
                `;
                tbody.appendChild(row);
            });
        }

        /**
         * Alterna entre as abas principais da tela de aprova√ß√£o do gestor.
         * @param {string} tabType O tipo da aba a ser ativada ('pendingApproval', 'finalizedOrders').
         */
        function switchRenatoApprovalMainTab(tabType) {
            const mainTabs = ['pendingApprovalTab', 'finalizedOrdersTab'];
            mainTabs.forEach(id => {
                const tabElement = document.getElementById(id);
                if (tabElement) {
                    tabElement.classList.remove('active');
                    tabElement.classList.add('hidden');
                }
            });

            const mainTabButtonsContainer = document.getElementById('renatoApprovalMainTabs');
            Array.from(mainTabButtonsContainer.children).forEach(button => {
                button.classList.remove('active');
            });

            // Hide detailed view if visible
            document.getElementById('detailedApprovalView').classList.add('hidden');
            document.getElementById('detailedApprovalView').classList.remove('active'); // Ensure it's not active

            if (tabType === 'pendingApproval') {
                document.getElementById('pendingApprovalTab').classList.add('active');
                document.getElementById('pendingApprovalTab').classList.remove('hidden');
                mainTabButtonsContainer.children[0].classList.add('active');
                renderPendingRenatoApprovalList();
            } else if (tabType === 'finalizedOrders') {
                document.getElementById('finalizedOrdersTab').classList.add('active');
                document.getElementById('finalizedOrdersTab').classList.remove('hidden');
                mainTabButtonsContainer.children[1].classList.add('active');
                renderFinalizedRenatoApprovalList();
            }
        }

        /**
         * Alterna entre as sub-abas da vis√£o detalhada da PO.
         * @param {string} tabType O tipo da sub-aba a ser ativada ('general', 'documents').
         */
        function switchDetailedPOTab(tabType) {
            const subTabs = ['generalTabContent', 'documentsTabContent'];
            subTabs.forEach(id => {
                const tabElement = document.getElementById(id);
                if (tabElement) {
                    tabElement.classList.remove('active');
                    tabElement.classList.add('hidden');
                }
            });

            const subTabButtonsContainer = document.getElementById('detailedPoSubTabs');
            Array.from(subTabButtonsContainer.children).forEach(button => {
                button.classList.remove('active');
            });

            if (tabType === 'general') {
                document.getElementById('generalTabContent').classList.add('active');
                document.getElementById('generalTabContent').classList.remove('hidden');
                subTabButtonsContainer.children[0].classList.add('active');
                renderPOAnalysisContent(); // Re-render general content
            } else if (tabType === 'documents') {
                document.getElementById('documentsTabContent').classList.add('active');
                document.getElementById('documentsTabContent').classList.remove('hidden');
                subTabButtonsContainer.children[1].classList.add('active');
                renderDocumentsContent(); // Render documents content
            }
        }

        /**
         * Renderiza a lista de POs aguardando aprova√ß√£o.
         */
        function renderPendingRenatoApprovalList() {
            const pendingForRenato = generatedPurchaseOrders.filter(po =>
                po.overallApprovalStatus === 'Aguardando Aprova√ß√£o'
            ).sort((a, b) => {
                // Ordena por data (mais antiga primeiro) e depois por ID
                if (a.date > b.date) return 1;
                if (a.date < b.date) return -1;
                return a.id.localeCompare(b.id);
            });
            renderPOTable('pendingOrdersTableBody', pendingForRenato, 'Visualizar Detalhes', 'viewDetailedApproval');
        }

        /**
         * Renderiza a lista de POs finalizadas (Aprovadas, Rejeitadas ou Finalizadas).
         */
        function renderFinalizedRenatoApprovalList() {
            const finalizedForRenato = generatedPurchaseOrders.filter(po =>
                po.overallApprovalStatus === 'Aprovado' ||
                po.overallApprovalStatus === 'Rejeitado' ||
                po.overallApprovalStatus === 'Finalizado' ||
                po.overallApprovalStatus === 'Negociado' // Inclui negociados que j√° foram revisados
            ).sort((a, b) => {
                if (a.date > b.date) return 1;
                if (a.date < b.date) return -1;
                return a.id.localeCompare(b.id);
            });
            renderPOTable('finalizedOrdersTableBody', finalizedForRenato, 'Visualizar Detalhes', 'viewDetailedApproval');
        }

        /**
         * Exibe a vis√£o detalhada de aprova√ß√£o para uma PO espec√≠fica.
         * @param {string} poId O ID da PO a ser detalhada.
         */
        function viewDetailedApproval(poId) {
            document.getElementById('analysisLoadingScreen').classList.add('active');

            setTimeout(() => {
                document.getElementById('analysisLoadingScreen').classList.remove('active');

                currentViewingPO = generatedPurchaseOrders.find(po => po.id === poId);
                if (!currentViewingPO) {
                    showMessage('Erro', 'Detalhes do pedido de compra n√£o encontrados.', 'error');
                    return;
                }

                // Hide main tabs and show detailed view
                document.getElementById('renatoApprovalMainTabs').classList.add('hidden');
                document.getElementById('pendingApprovalTab').classList.add('hidden');
                document.getElementById('finalizedOrdersTab').classList.add('hidden');

                document.getElementById('detailedApprovalView').classList.remove('hidden');
                document.getElementById('detailedApprovalView').classList.add('active');

                document.getElementById('currentDetailedParentOrderIdDisplay').innerText = currentViewingPO.parentOrderId || currentViewingPO.id;

                // Activate 'Geral' tab by default when entering detailed view
                switchDetailedPOTab('general');
                checkApprovalButtonsState();
            }, 2000); // Simula um tempo de carregamento
        }

        /**
         * Retorna para a lista principal de pedidos (Aguardando Aprova√ß√£o/Finalizados).
         */
        function backToMainList() {
            document.getElementById('detailedApprovalView').classList.add('hidden');
            document.getElementById('detailedApprovalView').classList.remove('active');

            document.getElementById('renatoApprovalMainTabs').classList.remove('hidden');
            switchRenatoApprovalMainTab('pendingApproval'); // Volta para a aba de pendentes por padr√£o
        }

        /**
         * Renderiza o conte√∫do anal√≠tico da PO para a tela de aprova√ß√£o gerencial.
         */
        function renderPOAnalysisContent() {
            const analysisContentDiv = document.getElementById('poAnalysisContent');
            analysisContentDiv.innerHTML = ''; // Limpa o conte√∫do anterior

            const po = currentViewingPO;

            // --- C√°lculos Financeiros da PO (geral) ---
            const totalExternalCostPO = parseFloat(po.newSupplierPriceTotal);
            const totalInternalCostPO = parseFloat(po.currentInternalPriceTotal);
            const costDifferencePO = totalExternalCostPO - totalInternalCostPO;
            const costDifferencePercentPO = totalInternalCostPO === 0 ? 0 : (costDifferencePO / totalInternalCostPO) * 100;

            let totalInternalSaleValuePO = 0;
            po.products.forEach(p => {
                totalInternalSaleValuePO += (parseFloat(p.currentInternalSalePrice) || 0) * p.quantity;
            });

            const grossProfitPO = totalInternalSaleValuePO - totalExternalCostPO;
            const grossMarginPO = totalInternalSaleValuePO > 0 ? (grossProfitPO / totalInternalSaleValuePO) * 100 : 0;

            // --- C√°lculos de Cubagem ---
            const totalCubage = parseFloat(po.totalCubage || 0);
            // REMOVIDOS: MAX_CUBAGE_20HC, MAX_CUBAGE_40HC, percentageOccupation20HC, percentageOccupation40HC, containerSuggestion

            // --- HTML Structure ---
            let htmlContent = `
                <div class="po-overview">
                    <div class="po-overview-left">
                        <h3>Informa√ß√µes da PO</h3>
                        <p><strong>PO N¬∫:</strong> ${po.id}</p>
                        <p><strong>ID Solicita√ß√£o Principal:</strong> ${po.parentOrderId || 'N/A'}</p>
                        <p><strong>Data Gera√ß√£o:</strong> ${po.date}</p>
                        <p><strong>√öltima Atualiza√ß√£o:</strong> ${po.lastUpdateDate}</p>
                        <p><strong>Status Geral:</strong> <span class="status-indicator ${getStatusClass(po.overallApprovalStatus)}"></span>${po.overallApprovalStatus}</p>
                    </div>
                    <div class="po-overview-right">
                        <h3>Partes Envolvidas</h3>
                        <p><strong>Cliente:</strong> ${po.clientName || 'N/A'}</p>
                        <p><strong>Fornecedor:</strong> ${po.supplierCode || 'N/A'} - ${po.supplier || 'N/A'}</p>
                        <p><strong>Email Fornecedor:</strong> ${po.supplierEmail || 'N/A'}</p>
                        <p><strong>Endere√ßo Faturamento:</strong> ${po.billTo || 'N/A'}</p>
                        <p><strong>Endere√ßo Entrega:</strong> ${po.shipTo || 'N/A'}</p>
                    </div>
                </div>

                <h3 class="font-semibold text-lg mb-3 mt-4" style="color: var(--dark-blue);">An√°lise Financeira da PO</h3>
                <div class="financial-summary">
                    <div class="financial-metric">
                        <div class="label">Custo Total Interno</div>
                        <div class="value">$ ${totalInternalCostPO.toFixed(2).replace('.', ',')}</div>
                    </div>
                    <div class="financial-metric">
                        <div class="label">Custo Total Fornecedor</div>
                        <div class="value">$ ${totalExternalCostPO.toFixed(2).replace('.', ',')}</div>
                    </div>
                    <div class="financial-metric">
                        <div class="label">Diferen√ßa de Custo</div>
                        <div class="value ${costDifferencePO > 0 ? 'price-difference-positive' : (costDifferencePO < 0 ? 'price-difference-negative' : '')}">
                            $ ${costDifferencePO.toFixed(2).replace('.', ',')} (${costDifferencePercentPO.toFixed(2)}%)
                        </div>
                    </div>
                    <div class="financial-metric">
                        <div class="label">Valor Total de Venda (Est.)</div>
                        <div class="value">$ ${totalInternalSaleValuePO.toFixed(2).replace('.', ',')}</div>
                    </div>
                    <div class="financial-metric">
                        <div class="label">Lucro Bruto Estimado</div>
                        <div class="value ${grossProfitPO < 0 ? 'price-difference-positive' : 'price-difference-negative'}">$ ${grossProfitPO.toFixed(2).replace('.', ',')}</div>
                    </div>
                    <div class="financial-metric">
                        <div class="label">Margem Bruta Estimada</div>
                        <div class="value ${grossMarginPO < (po.products[0]?.targetProfitMarginPercent || 0) ? 'price-difference-positive' : 'price-difference-negative'}">
                            ${grossMarginPO.toFixed(2).replace('.', ',')}%
                        </div>
                    </div>
                </div>

                <h3 class="font-semibold text-lg mb-3 mt-4" style="color: var(--dark-blue);">Detalhes Log√≠sticos e Comerciais</h3>
                <div class="logistics-commercial-details">
                    <div class="detail-item">
                        <div class="label">Pa√≠s de Origem:</div>
                        <div class="value">${po.originCountry || 'N/A'}</div>
                    </div>
                    <div class="detail-item">
                        <div class="label">Porto de Destino:</div>
                        <div class="value">${po.portDestination || 'N/A'}</div>
                    </div>
                    <div class="detail-item">
                        <div class="label">Termos de Frete:</div>
                        <div class="value">${po.terms || 'N/A'}</div>
                    </div>
                    <div class="detail-item">
                        <div class="label">Tipo de Frete:</div>
                        <div class="value">${po.freight || 'N/A'}</div>
                    </div>
                    <div class="detail-item">
                        <div class="label">ETD (Sa√≠da Estimada):</div>
                        <div class="value">${po.etd || 'N/A'}</div>
                    </div>
                    <div class="detail-item">
                        <div class="label">ETA (Chegada Estimada):</div>
                        <div class="value">${po.eta || 'N/A'}</div>
                    </div>
                    <div class="detail-item">
                        <div class="label">Cubagem Total:</div>
                        <div class="value">${totalCubage.toFixed(2).replace('.', ',')} m¬≥</div>
                    </div>
                </div>

                <h3 class="font-semibold text-lg mb-3 mt-4" style="color: var(--dark-blue);">Hist√≥rico de Status da PO</h3>
                <div class="tracking-timeline">
                    ${po.statusHistory.map((history, index) => `
                        <div class="timeline-step ${getStatusClass(history.status)}">
                            <div class="circle">${index + 1}</div>
                            <span>${history.status}<br>${history.date}</span>
                        </div>
                    `).join('')}
                </div>

                <h3 class="font-semibold text-lg mb-3 mt-4" style="color: var(--dark-blue);">An√°lise Detalhada dos Produtos</h3>
                <div class="overflow-x-auto">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th colspan="5" class="po-header">PO</th>
                                <th colspan="5" class="pi-header">PI (RETORNO DO FORNECEDOR)</th>
                                <th colspan="6" style="background-color: #e9e9e9;">DIVERG√äNCIAS</th>
                            </tr>
                            <tr>
                                <th class="po-column">MODEL</th>
                                <th class="po-column">P.N.</th>
                                <th class="po-column">QTY</th>
                                <th class="po-column">UNIT PRICE</th>
                                <th class="po-column">TOTAL AMOUNT</th>
                                <th class="pi-column">MODEL</th>
                                <th class="pi-column">P.N.</th>
                                <th class="pi-column">QTY</th>
                                <th class="pi-column">UNIT PRICE</th>
                                <th class="pi-column">TOTAL AMOUNT</th>
                                <th>QTY PI/PO</th>
                                <th>PRE√áO PI/PO</th>
                                <th>MODELO</th>
                                <th>P.N.</th>
                                <th>%</th>
                                <th>A√ß√£o</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${po.products.map((p, pIndex) => {
                                const diffPrice = parseFloat(p.newSupplierUnitPrice) - parseFloat(p.currentInternalUnitPrice);
                                const percentPriceDiff = parseFloat(p.currentInternalUnitPrice) === 0
                                    ? 0
                                    : (diffPrice / parseFloat(p.currentInternalUnitPrice)) * 100;
                                const priceDiffClass = percentPriceDiff > 0 ? 'price-difference-positive' : (percentPriceDiff < 0 ? 'price-difference-negative' : '');
                                
                                const poTotalAmount = (parseFloat(p.currentInternalUnitPrice) * p.quantity).toFixed(2);
                                const piTotalAmount = (parseFloat(p.newSupplierUnitPrice) * (p.piQuantity || p.quantity)).toFixed(2); // Use piQuantity if available

                                // Diverg√™ncias
                                const qtyMatch = (p.quantity === (p.piQuantity || p.quantity)) ? 'VERDADEIRO' : 'FALSO';
                                const modelMatch = (p.code === (p.piModel || p.code)) ? 'VERDADEIRO' : 'FALSO';
                                const pnMatch = (p.code === (p.piPN || p.code)) ? 'VERDADEIRO' : 'FALSO'; // Assuming P.N. is same as code for simplicity if not specified

                                return `
                                    <tr>
                                        <td class="po-column">${p.code}</td>
                                        <td class="po-column">${p.code}</td>
                                        <td class="po-column">${p.quantity}</td>
                                        <td class="po-column">$ ${parseFloat(p.currentInternalUnitPrice).toFixed(2).replace('.', ',')}</td>
                                        <td class="po-column">$ ${poTotalAmount.replace('.', ',')}</td>
                                        <td class="pi-column">${p.piModel || p.code}</td> <!-- Use piModel if available -->
                                        <td class="pi-column">${p.piPN || p.code}</td> <!-- Use piPN if available -->
                                        <td class="pi-column">${p.piQuantity || p.quantity}</td> <!-- Use piQuantity if available -->
                                        <td class="pi-column">$ ${parseFloat(p.newSupplierUnitPrice).toFixed(2).replace('.', ',')}</td>
                                        <td class="pi-column">$ ${piTotalAmount.replace('.', ',')}</td>
                                        <td>${qtyMatch}</td>
                                        <td>$ ${diffPrice.toFixed(2).replace('.', ',')}</td> <!-- Diferen√ßa absoluta de pre√ßo -->
                                        <td>${modelMatch}</td>
                                        <td>${pnMatch}</td>
                                        <td><span class="${priceDiffClass}">${percentPriceDiff.toFixed(2).replace('.', ',')}%</span></td> <!-- Nova coluna de percentual -->
                                        <td>
                                            <select class="action-select" onchange="setProductApprovalStatus('${po.id}', '${p.code}', this.value)">
                                                <option value="Pendente" ${p.approvalStatus === 'Pendente' ? 'selected' : ''}>Pendente</option>
                                                <option value="Aprovado" ${p.approvalStatus === 'Aprovado' ? 'selected' : ''}>Aprovar</option>
                                                <option value="Negociar" ${p.approvalStatus === 'Negociar' ? 'selected' : ''}>Negociar</option>
                                                <option value="Rejeitar" ${p.approvalStatus === 'Rejeitar' ? 'selected' : ''}>Rejeitar</option>
                                            </select>
                                        </td>
                                    </tr>
                                `;
                            }).join('')}
                        </tbody>
                    </table>
                </div>
            `;
            analysisContentDiv.innerHTML = htmlContent;
        }

        /**
         * Define o status de aprova√ß√£o de um produto espec√≠fico dentro de uma PO.
         * @param {string} poId O ID da PO.
         * @param {string} productCode O c√≥digo do produto.
         * @param {string} status O novo status de aprova√ß√£o ('Pendente', 'Aprovado', 'Negociar', 'Rejeitar').
         */
        function setProductApprovalStatus(poId, productCode, status) {
            const po = generatedPurchaseOrders.find(p => p.id === poId);
            if (po) {
                const product = po.products.find(prod => prod.code === productCode);
                if (product) {
                    product.approvalStatus = status;
                    renderPOAnalysisContent(); // Atualiza a exibi√ß√£o para refletir a mudan√ßa
                    checkApprovalButtonsState(); // Verifica se os bot√µes de a√ß√£o final devem ser habilitados
                }
            }
        }

        /**
         * Verifica o estado dos bot√µes "Finalizar Aprova√ß√£o" e "Gerar Invoice".
         * Eles s√£o habilitados apenas se todos os produtos da PO atual tiverem um status de aprova√ß√£o definido (n√£o 'Pendente').
         */
        function checkApprovalButtonsState() {
            const finalizeApprovalBtn = document.getElementById('finalizeApprovalBtn');
            const generateInvoiceBtn = document.getElementById('generateInvoiceBtn');

            // Verifica se currentViewingPO existe e se todos os produtos t√™m status diferente de 'Pendente'
            const allProductsReviewed = currentViewingPO && currentViewingPO.products.every(p => p.approvalStatus !== 'Pendente');

            if (finalizeApprovalBtn) {
                finalizeApprovalBtn.disabled = !allProductsReviewed;
            }
            if (generateInvoiceBtn) {
                generateInvoiceBtn.disabled = !allProductsReviewed;
            }
        }

        /**
         * Handler para o clique no bot√£o "Gerar Invoice".
         * Verifica se todos os produtos foram revisados antes de chamar generateInvoicePdf().
         */
        function handleGenerateInvoiceClick() {
            if (!currentViewingPO) {
                showMessage('Erro', 'Nenhum pedido selecionado para gerar a Invoice.', 'error');
                return;
            }
            const allProductsReviewed = currentViewingPO.products.every(p => p.approvalStatus !== 'Pendente');
            if (!allProductsReviewed) {
                showMessage('Aten√ß√£o', 'N√£o √© poss√≠vel gerar a Invoice. Por favor, defina o status (Aprovar, Negociar ou Rejeitar) para TODOS os produtos.', 'warning');
            } else {
                generateInvoicePdf();
            }
        }

        /**
         * Handler para o clique no bot√£o "Finalizar Aprova√ß√£o".
         * Verifica se todos os produtos foram revisados antes de chamar displayRenatoFinalSummary().
         */
        function handleFinalizeApprovalClick() {
            if (!currentViewingPO) {
                showMessage('Erro', 'Nenhum pedido selecionado para finalizar aprova√ß√£o.', 'error');
                return;
            }
            const allProductsReviewed = currentViewingPO.products.every(p => p.approvalStatus !== 'Pendente');
            if (!allProductsReviewed) {
                showMessage('Aten√ß√£o', 'Por favor, defina o status (Aprovar, Negociar ou Rejeitar) para TODOS os produtos antes de finalizar.', 'warning');
            } else {
                displayRenatoFinalSummary();
            }
        }

        /**
         * Exibe o resumo final da aprova√ß√£o e atualiza o status da PO.
         */
        function displayRenatoFinalSummary() {
            // A valida√ß√£o de produtos pendentes j√° foi feita em handleFinalizeApprovalClick
            // currentViewingPO j√° deve estar definido aqui

            let approvedCount = 0;
            let negotiateCount = 0;
            let rejectedCount = 0;
            let totalProducts = currentViewingPO.products.length;

            currentViewingPO.products.forEach(p => {
                if (p.approvalStatus === 'Aprovado') approvedCount++;
                else if (p.approvalStatus === 'Negociar') negotiateCount++;
                else if (p.approvalStatus === 'Rejeitar') rejectedCount++;
            });

            let finalTitle = '';
            let finalMessage = '';
            let finalDetailsHtml = '';

            if (approvedCount === totalProducts) {
                currentViewingPO.overallApprovalStatus = 'Aprovado';
                finalTitle = 'Aprova√ß√£o Conclu√≠da!';
                finalMessage = `Todos os ${totalProducts} produtos do pedido ${currentViewingPO.id} foram APROVADOS pela Ger√™ncia.`;
                finalDetailsHtml = `<p>O pedido foi aprovado e agora o processo segue para a equipe de Compras.</p>`;
            } else if (rejectedCount === totalProducts) {
                currentViewingPO.overallApprovalStatus = 'Rejeitado';
                finalTitle = 'Pedido Rejeitado';
                finalMessage = `Todos os ${totalProducts} produtos do pedido ${currentViewingPO.id} foram REJEITADOS pela Ger√™ncia.`;
                finalDetailsHtml = `<p>O pedido foi rejeitado e o processo ser√° encerrado.</p>`;
            } else if (negotiateCount > 0 || rejectedCount > 0) {
                currentViewingPO.overallApprovalStatus = 'Negociado'; // Altera para Negociado se houver itens para renegociar
                finalTitle = 'Aprova√ß√£o com Pend√™ncias';
                finalMessage = `O pedido ${currentViewingPO.id} foi parcialmente aprovado ou possui itens para renegocia√ß√£o/rejei√ß√£o.`;
                finalDetailsHtml = `
                    <p>${approvedCount} produto(s) aprovado(s).</p>
                    <p>${negotiateCount} produto(s) para renegocia√ß√£o.</p>
                    <p>${rejectedCount} produto(s) rejeitado(s).</p>
                    <p class="mt-4">O pedido retornar√° para a Central de Compras para que as renegocia√ß√µes e/ou rejei√ß√µes sejam tratadas.</p>
                `;
            } else {
                // Should not happen if checkAllProductsReviewed is working correctly, but as a fallback
                showMessage('Erro', 'Status de aprova√ß√£o inconsistente. Por favor, verifique e tente novamente.', 'error');
                return;
            }

            // Atualiza a data da √∫ltima atualiza√ß√£o da PO e adiciona ao hist√≥rico
            const today = new Date().toISOString().slice(0, 10);
            currentViewingPO.lastUpdateDate = today;
            if (!currentViewingPO.statusHistory) {
                currentViewingPO.statusHistory = [];
            }
            // Adiciona o novo status apenas se for diferente do √∫ltimo
            const lastStatus = currentViewingPO.statusHistory.length > 0 ? currentViewingPO.statusHistory[currentViewingPO.statusHistory.length - 1].status : '';
            if (lastStatus !== currentViewingPO.overallApprovalStatus) {
                currentViewingPO.statusHistory.push({ status: currentViewingPO.overallApprovalStatus, date: today });
            }

            document.getElementById('hongKongFinalTitle').innerText = finalTitle;
            document.getElementById('hongKongFinalMessage').innerText = finalMessage;
            document.getElementById('finalDetailsHK').innerHTML = finalDetailsHtml;

            showScreen('hongKongFinalScreen');

            currentViewingPO = null; // Limpa a PO em visualiza√ß√£o
            synchronizePOs(); // Sincroniza os dados ap√≥s a aprova√ß√£o
        }

        /**
         * Sincroniza o status das POs ap√≥s as a√ß√µes do gestor.
         */
        function synchronizePOs() {
            // Re-renderiza a lista de POs na aba ativa do gestor para refletir as mudan√ßas
            const activeTabButton = document.querySelector('#renatoApprovalMainTabs .tab-button.active');
            if (activeTabButton) {
                switchRenatoApprovalMainTab(activeTabButton.onclick.toString().match(/switchRenatoApprovalMainTab\('(\w+)'\)/)[1]);
            } else {
                switchRenatoApprovalMainTab('pendingApproval'); // Fallback
            }
        }

        /**
         * Abre o modal do fluxograma.
         */
        function openFlowchartModal() {
            document.getElementById('flowchartModal').classList.add('active');
        }

        /**
         * Fecha o modal do fluxograma.
         */
        function closeFlowchartModal() {
            document.getElementById('flowchartModal').classList.remove('active');
        }

        /**
         * Renderiza o conte√∫do da aba "Documentos".
         */
        function renderDocumentsContent() {
            const documentsContentDiv = document.getElementById('documentsContent');
            documentsContentDiv.innerHTML = ''; // Clear previous content

            // Documents are now specific to the currentViewingPO
            const documents = [
                {
                    name: 'Solicita√ß√£o do Cliente',
                    icon: 'üìÑ', // Emoji icon for document
                    type: 'client_request',
                    description: 'Documento original da solicita√ß√£o do cliente.'
                },
                {
                    name: 'PO do Compras',
                    icon: 'üõí', // Emoji icon for shopping cart/PO
                    type: 'purchase_order',
                    description: 'Ordem de Compra gerada pela equipe de compras.'
                },
                {
                    name: 'PI do Fornecedor',
                    icon: 'üí∞', // Emoji icon for money/invoice
                    type: 'proforma_invoice',
                    description: 'Proforma Invoice (Fatura Proforma) enviada pelo fornecedor.'
                },
                {
                    name: 'Invoice Cliente',
                    icon: 'üßæ', // Emoji icon for receipt/invoice
                    type: 'client_invoice',
                    description: 'Invoice final emitida para o cliente.'
                }
            ];

            // If a PO is being viewed, display its ID in the document tab header
            const poIdDisplay = currentViewingPO ? currentViewingPO.id : 'N/A';
            // Note: The h2 for "Documentos do Pedido" is now part of the HTML structure of detailedApprovalView
            // We don't need currentDocumentPoIdDisplay anymore as it's handled by currentDetailedParentOrderIdDisplay

            documents.forEach(doc => {
                const card = document.createElement('div');
                card.classList.add('document-card');
                card.innerHTML = `
                    <div class="icon">${doc.icon}</div>
                    <h4>${doc.name}</h4>
                    <p style="font-size: 0.85rem; color: #777; margin-bottom: 15px;">${doc.description}</p>
                    <button class="btn-view" onclick="openDocument('${doc.type}', '${doc.name}')">Visualizar</button>
                `;
                documentsContentDiv.appendChild(card);
            });
        }

        /**
         * Abre o modal para visualizar um documento (agora simulado).
         * @param {string} docType Tipo do documento ('client_request', 'purchase_order', 'proforma_invoice', 'client_invoice').
         * @param {string} docName Nome do documento a ser exibido no t√≠tulo do modal.
         */
        function openDocument(docType, docName) {
            const modal = document.getElementById('documentViewerModal');
            const titleElement = document.getElementById('documentViewerTitle');
            const messageElement = document.getElementById('documentViewerMessage');

            titleElement.innerText = `Visualizando: ${docName}`;
            
            let simulatedContent = '';
            if (docType === 'client_invoice') {
                simulatedContent = `<p>Este √© o documento "Invoice Cliente" para o pedido ${currentViewingPO ? currentViewingPO.id : 'N/A'}.</p><p>Conte√∫do simulado.</p>`;
            } else {
                simulatedContent = `<p>O documento "${docName}" seria exibido aqui.</p><p>Esta √© uma visualiza√ß√£o simulada de PDF.</p>`;
            }

            messageElement.innerHTML = simulatedContent;
            
            modal.classList.add('active');
        }

        /**
         * Fecha o modal de visualiza√ß√£o de documentos.
         */
        function closeDocumentViewerModal() {
            document.getElementById('documentViewerModal').classList.remove('active');
            document.getElementById('documentViewerMessage').innerHTML = ''; // Clear message
        }

        /**
         * Extrai o Incoterm (FOB, EXW, CIF) de uma string de termos.
         * @param {string} termsString A string completa dos termos (e.g., "20% TT balance after BL - FOB Ningbo Port").
         * @returns {string} O Incoterm extra√≠do ou "N/A" se n√£o encontrado.
         */
        function extractIncoterm(termsString) {
            if (!termsString) {
                return 'N/A';
            }
            // Regex para encontrar FOB, EXW, CIF no in√≠cio ou em qualquer parte da string
            const match = termsString.match(/\b(FOB|EXW|CIF)\b/i);
            return match ? match[0].toUpperCase() : 'N/A';
        }

        /**
         * Gera o conte√∫do HTML da Invoice com base nos dados da PO, replicando o layout da imagem.
         * @param {Object} po O objeto da Purchase Order.
         * @returns {string} O HTML da invoice.
         */
        function generateInvoiceHtmlContent(po) {
            // Use current date for simulation, or a fixed date for consistency
            const today = new Date().toLocaleDateString('en-US', { year: 'numeric', month: '2-digit', day: '2-digit' });
            const piNo = po.id.replace('PED-', 'PI-'); // Example PI No.
            const ourRef = po.orderNumber || 'N/A';

            let productsHtml = po.products.map((p, index) => {
                const itemNo = (index + 1).toString().padStart(2, '0');
                const quantity = p.piQuantity || p.quantity;
                const priceListUnitUSD = parseFloat(p.newSupplierUnitPrice).toFixed(2);
                // For simulation, let's make Net Price Unit a fixed percentage of Price List Unit
                const netPriceUnitUSD = (parseFloat(priceListUnitUSD) * 0.95).toFixed(2); // Example: 5% discount
                const amountUSD = (quantity * parseFloat(netPriceUnitUSD)).toFixed(2);

                return `
                    <tr>
                        <td class="text-center">${itemNo}</td>
                        <td class="text-center">${p.piModel || p.code}</td>
                        <td class="text-center">${p.piPN || p.code}</td>
                        <td>${p.name}</td>
                        <td class="text-center">${quantity}</td>
                        <td class="text-right">$ ${priceListUnitUSD}</td>
                        <td class="text-right">$ ${netPriceUnitUSD}</td>
                        <td class="text-right">$ ${amountUSD}</td>
                    </tr>
                `;
            }).join('');

            const subtotal = po.products.reduce((sum, p) => {
                const quantity = p.piQuantity || p.quantity;
                const priceListUnitUSD = parseFloat(p.newSupplierUnitPrice).toFixed(2);
                const netPriceUnitUSD = (parseFloat(priceListUnitUSD) * 0.95).toFixed(2);
                return sum + (quantity * parseFloat(netPriceUnitUSD));
            }, 0).toFixed(2);

            const otherCharge = 250.00; // Example fixed other charge
            const invoiceTotal = (parseFloat(subtotal) + otherCharge).toFixed(2);

            // Extract Incoterm using the new function
            const incoterm = extractIncoterm(po.terms);

            return `
                <div class="simulated-invoice">
                    <table class="invoice-table" style="border: none;">
                        <tr>
                            <td style="width: 60%; border: none; vertical-align: top;">
                                <div class="flex-container" style="margin-bottom: 10px;">
                                    <img src="https://raw.githubusercontent.com/SamuelJuniorrr/importexport/refs/heads/main/logo.png" alt="Toyama Logo" class="logo">
                                    <div class="font-bold" style="font-size: 14px;">TOYAMA HONG KONG LTD.</div>
                                </div>
                                <div style="font-size: 10px;">
                                    Suite 01-02A, 9/F, Tower 5, China Hong Kong City<br>
                                    33 Canton Road, Tsim Sha Tsui, Kowloon, Hong Kong<br>
                                    Tel.: 852-2542 8343<br>
                                    Fax.: 852-2544 7002
                                </div>
                            </td>
                            <td style="width: 40%; border: none; vertical-align: top; text-align: right;">
                                <table class="invoice-table" style="width: 100%; border: 1px solid #000;">
                                    <tr>
                                        <td class="invoice-info-box invoice-header-cell" style="width: 40%;">Date:</td>
                                        <td class="invoice-info-box">${today}</td>
                                    </tr>
                                    <tr>
                                        <td class="invoice-info-box invoice-header-cell">PI No:</td>
                                        <td class="invoice-info-box">${piNo}</td>
                                    </tr>
                                    <tr>
                                        <td class="invoice-info-box invoice-header-cell">Our Ref.:</td>
                                        <td class="invoice-info-box">${ourRef}</td>
                                    </tr>
                                </table>
                            </td>
                        </tr>
                    </table>

                    <table class="invoice-table" style="margin-top: 10px;">
                        <tr>
                            <td style="width: 50%; vertical-align: top; padding: 0;">
                                <div class="section-header">BILL TO</div>
                                <div style="border: 1px solid #000; border-top: none; padding: 5px; font-size: 10px; min-height: 80px;">
                                    <strong class="font-bold">Company Address</strong> ${po.billTo || 'N/A'}<br>
                                    <strong class="font-bold">Tax ID</strong> ${po.clientCnpj || 'N/A'}<br>
                                    <strong class="font-bold">Phone</strong> N/A<br>
                                    <strong class="font-bold">Email</strong> ${po.clientEmail || 'N/A'}<br>
                                    <strong class="font-bold">Contact</strong> N/A
                                </div>
                            </td>
                            <td style="width: 50%; vertical-align: top; padding: 0;">
                                <div class="section-header">SHIP TO</div>
                                <div style="border: 1px solid #000; border-top: none; padding: 5px; font-size: 10px; min-height: 80px;">
                                    <strong class="font-bold">Company Address</strong> ${po.shipTo || 'N/A'}<br>
                                    <strong class="font-bold">Tax ID</strong> N/A<br>
                                    <strong class="font-bold">Phone</strong> N/A<br>
                                    <strong class="font-bold">Email</strong> N/A<br>
                                    <strong class="font-bold">Contact</strong> N/A
                                </div>
                            </td>
                        </tr>
                    </table>

                    <div class="transport-main-header">TRANSPORT</div>
                    <table class="transport-grid-table">
                        <tr>
                            <td class="label-cell">Transport Method</td>
                            <td class="value-cell">SEA</td>
                            <td class="label-cell">ETD</td>
                            <td class="value-cell">${po.etd || 'N/A'}</td>
                        </tr>
                        <tr>
                            <td class="label-cell">Freight</td>
                            <td class="value-cell">${po.freight || 'N/A'}</td>
                            <td class="label-cell">Incoterm</td>
                            <td class="value-cell">${incoterm}</td> <!-- Changed this line -->
                        </tr>
                        <tr>
                            <td class="label-cell">Port of Origin</td>
                            <td class="value-cell">${po.originCountry || 'N/A'}</td>
                            <td class="label-cell">Destination Port</td>
                            <td class="value-cell">${po.portDestination || 'N/A'}</td>
                        </tr>
                        <tr>
                            <td class="label-cell">Country of Origin</td>
                            <td class="value-cell">${po.originCountry || 'N/A'}</td>
                            <td class="label-cell">Destination Country</td>
                            <td class="value-cell">BRAZIL</td>
                        </tr>
                    </table>

                    <table class="invoice-table" style="margin-top: 10px;">
                        <thead>
                            <tr>
                                <th class="invoice-header-cell" style="width: 5%;">Item</th>
                                <th class="invoice-header-cell" style="width: 10%;">Model</th>
                                <th class="invoice-header-cell" style="width: 10%;">Code</th>
                                <th class="invoice-header-cell" style="width: 35%;">Description</th>
                                <th class="invoice-header-cell" style="width: 5%;">Qty.</th>
                                <th class="invoice-header-cell" style="width: 10%;">Price List Unit (USD)</th>
                                <th class="invoice-header-cell" style="width: 10%;">Net Price Unit (USD)</th>
                                <th class="invoice-header-cell" style="width: 15%;">Amount</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${productsHtml}
                        </tbody>
                    </table>

                    <div style="font-size: 10px; margin-top: 10px;">
                        The discounts below are already progressively included in the unit prices
                    </div>

                    <table class="invoice-table" style="width: 40%; ${po.originCountry === 'Col√¥mbia' ? 'float: left;' : 'float: right;'} margin-top: 10px;">
                        <tr>
                            <td class="font-bold text-right invoice-header-cell">Subtotal</td>
                            <td class="text-right">$ ${subtotal}</td>
                        </tr>
                        <tr>
                            <td class="font-bold text-right invoice-header-cell">Other Charge</td>
                            <td class="text-right">$ ${otherCharge.toFixed(2)}</td>
                        </tr>
                        <tr>
                            <td class="font-bold text-right invoice-header-cell">Invoice Total</td>
                            <td class="text-right">$ ${invoiceTotal}</td>
                        </tr>
                    </table>
                    <div class="clear-both"></div>

                    <div style="margin-top: 20px;">
                        <div class="section-header">Bank Info.</div>
                        <table class="invoice-table">
                            <tr>
                                <td style="width: 30%;" class="font-bold">Bank Name:</td>
                                <td style="width: 70%;">TOYAMA HONG KONG LIMITED</td>
                            </tr>
                            <tr>
                                <td class="font-bold">Beneficiary Bank Address:</td>
                                <td>HSBCHKKHHHKH</td>
                            </tr>
                            <tr>
                                <td class="font-bold">SWIFT Code:</td>
                                <td>HSBCHKKHHHKH</td>
                            </tr>
                            <tr>
                                <td class="font-bold">Beneficiary A/C Name:</td>
                                <td>Toyama Hong Kong Limited</td>
                            </tr>
                            <tr>
                                <td class="font-bold">A/C No.:</td>
                                <td>852-418421-831</td>
                            </tr>
                            <tr>
                                <td class="font-bold">Payment Terms:</td>
                                <td>${po.terms || 'N/A'}</td>
                            </tr>
                        </table>
                    </div>

                    <div style="margin-top: 20px;">
                        <div class="section-header">Remarks:</div>
                        <div style="border: 1px solid #000; padding: 10px; min-height: 50px; font-size: 10px;">
                            <!-- Add any specific remarks here from PO if available -->
                        </div>
                    </div>

                    <table class="invoice-table" style="margin-top: 30px;">
                        <tr>
                            <td class="signature-box" style="width: 50%;">
                                <div style="margin-top: 30px;">Seller's confirmation</div>
                                <div style="border-top: 1px solid #000; width: 80%; margin: 5px auto 0;"></div>
                            </td>
                            <td class="signature-box" style="width: 50%;">
                                <div style="margin-top: 30px;">Buyer's confirmation</div>
                                <div style="border-top: 1px solid #000; width: 80%; margin: 5px auto 0;"></div>
                            </td>
                        </tr>
                    </table>
                </div>
            `;
        }

        /**
         * Simula a gera√ß√£o de um PDF de Invoice e o exibe em um modal.
         */
        function generateInvoicePdf() {
            // A valida√ß√£o de produtos pendentes j√° foi feita em handleGenerateInvoiceClick
            // currentViewingPO j√° deve estar definido aqui

            const invoicePdfViewerModal = document.getElementById('invoicePdfViewerModal');
            const invoicePdfMessage = document.getElementById('invoicePdfMessage');

            invoicePdfViewerModal.classList.add('active');
            // Inject the generated HTML directly into the message div
            invoicePdfMessage.innerHTML = generateInvoiceHtmlContent(currentViewingPO);

            console.log(`Simulando visualiza√ß√£o de Invoice para o pedido ${currentViewingPO.id}`);
        }

        /**
         * Fecha o modal de visualiza√ß√£o da Invoice.
         */
        function closeInvoicePdfViewerModal() {
            document.getElementById('invoicePdfViewerModal').classList.remove('active');
            document.getElementById('invoicePdfMessage').innerHTML = ''; // Limpa a mensagem
        }

        /**
         * Simula o processo de assinatura via DocSign.
         */
        function simulateDocSign() {
            showMessage('DocSign', 'Simulando o processo de assinatura eletr√¥nica via DocSign. Ap√≥s a assinatura, o documento ser√° enviado para as partes envolvidas.', 'info', () => {
                closeInvoicePdfViewerModal();
                // Aqui voc√™ poderia adicionar l√≥gica para mudar o status da PO para 'Invoice Gerada/Assinada'
                // currentViewingPO.overallApprovalStatus = 'Invoice Gerada'; // Exemplo
                // synchronizePOs();
            });
        }

        /**
         * Retorna para a tela de login.
         */
        function backToLogin() {
            logout();
        }

        // Listener para o evento DOMContentLoaded, que √© disparado quando o HTML √© completamente carregado
        document.addEventListener('DOMContentLoaded', () => {
            // Garante que todos os fornecedores nas POs tenham um c√≥digo gerado
            generatedPurchaseOrders.forEach(po => {
                if (po.supplier) {
                    getOrGenerateSupplierCode(po.supplier);
                }
            });

            switchRenatoApprovalMainTab('pendingApproval'); // Ativa a aba "Aguardando Aprova√ß√£o" por padr√£o

            // Listener para o bot√£o de logout
            const renatoLogoutButton = document.getElementById('renatoLogoutButton');
            if (renatoLogoutButton) {
                renatoLogoutButton.addEventListener('click', logout);
            }

            // Listener para o bot√£o de fechar do modal de mensagens
            const messageModalCloseBtn = document.getElementById('messageModalCloseBtn');
            if (messageModalCloseBtn) {
                messageModalCloseBtn.addEventListener('click', () => {
                    document.getElementById('messageModal').classList.remove('active');
                });
            }
        });
    </script>
</body>
</html>
